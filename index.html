<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory & Order Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f5f3ff',
                            100: '#ede9fe',
                            200: '#ddd6fe',
                            300: '#c4b5fd',
                            400: '#a78bfa',
                            500: '#8b5cf6',
                            600: '#7c3aed',
                            700: '#6d28d9',
                            800: '#5b21b6',
                            900: '#4c1d95',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
        
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        .barcode {
            font-family: 'Libre Barcode 39', cursive;
            font-size: 42px;
            line-height: 1;
        }
        
        /* Transition effects for page switching */
        .page-container {
            transition: all 0.3s ease-in-out;
        }

        .page-enter {
            opacity: 0;
            transform: translateY(10px);
        }

        .page-enter-active {
            opacity: 1;
            transform: translateY(0);
            transition: opacity 0.3s, transform 0.3s;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen transition-colors duration-300">
    <div id="app" class="min-h-screen flex flex-col">
        <!-- Login Screen -->
        <div id="login-container" class="min-h-screen flex items-center justify-center p-4">
            <div class="w-full max-w-md bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8 transition-all duration-300">
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Inventory Pro</h1>
                    <p class="text-gray-600 dark:text-gray-400">Sign in to your account</p>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Email</label>
                        <input id="email" type="email" class="w-full px-4 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="email@example.com" value="admin@example.com">
                    </div>
                    
                    <div>
                        <label for="password" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Password</label>
                        <input id="password" type="password" class="w-full px-4 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="••••••••" value="password">
                    </div>

                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <input id="remember-me" type="checkbox" class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600">
                            <label for="remember-me" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Remember me</label>
                        </div>
                        
                        <a href="#" class="text-sm font-medium text-primary-600 hover:text-primary-500 dark:text-primary-400">Forgot password?</a>
                    </div>
                    
                    <button id="login-btn" class="w-full bg-primary-600 hover:bg-primary-700 text-white font-medium py-2 px-4 rounded-md transition duration-300 flex items-center justify-center">
                        <span>Sign In</span>
                    </button>
                    
                    <div class="text-center mt-4">
                        <p class="text-sm text-gray-600 dark:text-gray-400">
                            Don't have an account? 
                            <a href="#" class="text-primary-600 hover:text-primary-500 dark:text-primary-400 font-medium">Contact administrator</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Application (Initially Hidden) -->
        <div id="main-container" class="hidden flex flex-col md:flex-row min-h-screen">
            <!-- Sidebar -->
            <aside class="w-full md:w-64 bg-white dark:bg-gray-800 shadow-md md:min-h-screen transition-all duration-300">
                <!-- Mobile Header -->
                <div class="md:hidden flex items-center justify-between p-4 border-b dark:border-gray-700">
                    <h1 class="text-xl font-bold text-gray-900 dark:text-white">Inventory Pro</h1>
                    <button id="mobile-menu-toggle" class="p-2 rounded-md text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700">
                        <i class="ri-menu-line text-xl"></i>
                    </button>
                </div>
                
                <!-- Sidebar Content -->
                <div id="sidebar-content" class="md:block hidden md:block">
                    <div class="p-4 border-b dark:border-gray-700">
                        <h1 class="text-xl font-bold text-gray-900 dark:text-white">Inventory Pro</h1>
                    </div>
                    
                    <div class="p-2">
                        <nav class="space-y-1">
                            <a href="#dashboard" class="nav-link flex items-center px-3 py-2 text-gray-600 dark:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 group transition-colors duration-200 active-nav">
                                <i class="ri-dashboard-line mr-3 text-gray-500 dark:text-gray-400 group-hover:text-primary-600 dark:group-hover:text-primary-400"></i>
                                <span>Dashboard</span>
                            </a>
                            <a href="#stock" class="nav-link flex items-center px-3 py-2 text-gray-600 dark:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 group transition-colors duration-200">
                                <i class="ri-store-line mr-3 text-gray-500 dark:text-gray-400 group-hover:text-primary-600 dark:group-hover:text-primary-400"></i>
                                <span>Stock Management</span>
                            </a>
                            <a href="#orders" class="nav-link flex items-center px-3 py-2 text-gray-600 dark:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 group transition-colors duration-200">
                                <i class="ri-file-list-3-line mr-3 text-gray-500 dark:text-gray-400 group-hover:text-primary-600 dark:group-hover:text-primary-400"></i>
                                <span>Order Management</span>
                            </a>
                            <a href="#reports" class="nav-link flex items-center px-3 py-2 text-gray-600 dark:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 group transition-colors duration-200">
                                <i class="ri-bar-chart-grouped-line mr-3 text-gray-500 dark:text-gray-400 group-hover:text-primary-600 dark:group-hover:text-primary-400"></i>
                                <span>Reports & Analytics</span>
                            </a>
                            <div id="admin-nav-section">
                                <a href="#users" class="nav-link flex items-center px-3 py-2 text-gray-600 dark:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 group transition-colors duration-200">
                                    <i class="ri-user-settings-line mr-3 text-gray-500 dark:text-gray-400 group-hover:text-primary-600 dark:group-hover:text-primary-400"></i>
                                    <span>User Management</span>
                                </a>
                                <a href="#settings" class="nav-link flex items-center px-3 py-2 text-gray-600 dark:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 group transition-colors duration-200">
                                    <i class="ri-settings-4-line mr-3 text-gray-500 dark:text-gray-400 group-hover:text-primary-600 dark:group-hover:text-primary-400"></i>
                                    <span>Settings</span>
                                </a>
                            </div>
                        </nav>
                    </div>
                    
                    <div class="mt-auto p-4 border-t dark:border-gray-700">
                        <div class="flex items-center mb-3">
                            <div class="w-8 h-8 rounded-full bg-primary-500 flex items-center justify-center text-white font-semibold mr-2" id="user-avatar">A</div>
                            <div>
                                <p class="text-sm font-medium text-gray-900 dark:text-white" id="user-name">Admin User</p>
                                <p class="text-xs text-gray-500 dark:text-gray-400" id="user-role">Administrator</p>
                            </div>
                        </div>
                        <button id="logout-btn" class="w-full flex items-center px-3 py-2 text-sm text-gray-600 dark:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200">
                            <i class="ri-logout-box-line mr-2"></i>
                            <span>Sign Out</span>
                        </button>
                    </div>
                </div>
            </aside>

            <!-- Main Content Area -->
            <main class="flex-1 p-4 md:p-6 overflow-auto bg-gray-50 dark:bg-gray-900 transition-all duration-300">
                <!-- Header with Search -->
                <div class="flex flex-col md:flex-row items-start md:items-center justify-between mb-6 gap-4">
                    <div>
                        <h1 id="page-title" class="text-2xl font-bold text-gray-900 dark:text-white">Dashboard</h1>
                        <p id="page-subtitle" class="text-gray-600 dark:text-gray-400">Welcome to your inventory management system</p>
                    </div>
                    
                    <div class="w-full md:w-auto flex flex-col md:flex-row gap-2">
                        <div class="relative">
                            <input id="global-search" type="text" placeholder="Search..." class="w-full md:w-64 pl-10 pr-4 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                            <i class="ri-search-line absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        </div>
                        
                        <button id="theme-toggle" class="p-2 rounded-md border text-gray-600 dark:text-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700">
                            <i class="ri-sun-line dark:hidden"></i>
                            <i class="ri-moon-line hidden dark:block"></i>
                        </button>
                    </div>
                </div>

                <!-- Content Pages Container -->
                <div id="content-container" class="page-container">
                    <!-- Dashboard Page -->
                    <div id="dashboard-page" class="page active">
                        <!-- Stats Overview -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">Total Stock Items</p>
                                        <h3 class="text-2xl font-bold text-gray-900 dark:text-white mt-1" id="total-stock-count">84</h3>
                                    </div>
                                    <div class="w-12 h-12 rounded-lg bg-primary-100 dark:bg-primary-900/20 flex items-center justify-center">
                                        <i class="ri-archive-line text-xl text-primary-600 dark:text-primary-400"></i>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <span class="text-xs text-green-600 dark:text-green-400 font-medium flex items-center">
                                        <i class="ri-arrow-up-line mr-1"></i>
                                        <span>5.3% from last month</span>
                                    </span>
                                </div>
                            </div>

                            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">Low Stock Items</p>
                                        <h3 class="text-2xl font-bold text-gray-900 dark:text-white mt-1" id="low-stock-count">7</h3>
                                    </div>
                                    <div class="w-12 h-12 rounded-lg bg-amber-100 dark:bg-amber-900/20 flex items-center justify-center">
                                        <i class="ri-alert-line text-xl text-amber-600 dark:text-amber-400"></i>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <span class="text-xs text-red-500 dark:text-red-400 font-medium flex items-center">
                                        <i class="ri-arrow-up-line mr-1"></i>
                                        <span>2 more than last week</span>
                                    </span>
                                </div>
                            </div>

                            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">Completed Orders</p>
                                        <h3 class="text-2xl font-bold text-gray-900 dark:text-white mt-1" id="completed-orders-count">142</h3>
                                    </div>
                                    <div class="w-12 h-12 rounded-lg bg-green-100 dark:bg-green-900/20 flex items-center justify-center">
                                        <i class="ri-check-double-line text-xl text-green-600 dark:text-green-400"></i>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <span class="text-xs text-green-600 dark:text-green-400 font-medium flex items-center">
                                        <i class="ri-arrow-up-line mr-1"></i>
                                        <span>12.7% from last month</span>
                                    </span>
                                </div>
                            </div>

                            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">Pending Orders</p>
                                        <h3 class="text-2xl font-bold text-gray-900 dark:text-white mt-1" id="pending-orders-count">23</h3>
                                    </div>
                                    <div class="w-12 h-12 rounded-lg bg-blue-100 dark:bg-blue-900/20 flex items-center justify-center">
                                        <i class="ri-time-line text-xl text-blue-600 dark:text-blue-400"></i>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <span class="text-xs text-amber-500 dark:text-amber-400 font-medium flex items-center">
                                        <i class="ri-arrow-right-line mr-1"></i>
                                        <span>Same as last week</span>
                                    </span>
                                </div>
                            </div>
                        </div>

                        <!-- Charts -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Sales Overview</h3>
                                <div class="w-full h-[300px]">
                                    <canvas id="sales-chart"></canvas>
                                </div>
                            </div>

                            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Stock by Category</h3>
                                <div class="w-full h-[300px]">
                                    <canvas id="category-chart"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Activity -->
                        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Recent Activity</h3>
                            <div class="overflow-x-auto">
                                <table class="min-w-full">
                                    <thead>
                                        <tr class="border-b dark:border-gray-700">
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Activity</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">User</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Time</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Details</th>
                                        </tr>
                                    </thead>
                                    <tbody id="activity-log-container">
                                        <!-- Activity log entries will be inserted here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Stock Management Page -->
                    <div id="stock-page" class="page hidden">
                        <!-- Action Bar -->
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
                            <div class="flex items-center gap-2">
                                <button id="add-stock-btn" class="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-md flex items-center transition duration-300">
                                    <i class="ri-add-line mr-2"></i>
                                    <span>Add Item</span>
                                </button>
                                
                                <button id="stock-export-btn" class="border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-800 dark:text-gray-200 px-4 py-2 rounded-md flex items-center transition duration-300">
                                    <i class="ri-download-line mr-2"></i>
                                    <span>Export</span>
                                </button>
                            </div>
                            
                            <div class="w-full sm:w-auto flex flex-col sm:flex-row gap-2">
                                <div class="relative">
                                    <input id="stock-search" type="text" placeholder="Search items..." class="w-full sm:w-64 pl-10 pr-4 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <i class="ri-search-line absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                </div>
                                
                                <select id="stock-category-filter" class="border rounded-md px-3 py-2 text-base focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <option value="">All Categories</option>
                                    <option value="electronics">Electronics</option>
                                    <option value="clothing">Clothing</option>
                                    <option value="furniture">Furniture</option>
                                    <option value="office">Office Supplies</option>
                                    <option value="food">Food & Beverage</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Stock Table -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden">
                            <div class="overflow-x-auto">
                                <table class="min-w-full">
                                    <thead>
                                        <tr class="border-b dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50">
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Item</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">SKU</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Category</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">In Stock</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Price</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Status</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="stock-table-body">
                                        <!-- Stock items will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <div id="stock-table-empty" class="hidden py-16 text-center">
                                <i class="ri-inbox-line text-5xl text-gray-300 dark:text-gray-600 mb-3"></i>
                                <p class="text-gray-500 dark:text-gray-400">No stock items found.</p>
                            </div>
                            
                            <!-- Pagination -->
                            <div class="px-4 py-3 border-t dark:border-gray-700 flex flex-col xs:flex-row items-center xs:justify-between">
                                <div class="text-sm text-gray-500 dark:text-gray-400 mb-2 xs:mb-0">
                                    Showing <span id="stock-showing-start">1</span> to <span id="stock-showing-end">10</span> of <span id="stock-total">50</span> entries
                                </div>
                                <div class="inline-flex shadow-sm">
                                    <button id="stock-prev-page" class="px-3 py-1 text-sm border dark:border-gray-600 rounded-l hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300">Previous</button>
                                    <button id="stock-next-page" class="px-3 py-1 text-sm border border-l-0 dark:border-gray-600 rounded-r hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300">Next</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Order Management Page -->
                    <div id="orders-page" class="page hidden">
                        <!-- Action Bar -->
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
                            <div class="flex items-center gap-2">
                                <button id="add-order-btn" class="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-md flex items-center transition duration-300">
                                    <i class="ri-add-line mr-2"></i>
                                    <span>New Order</span>
                                </button>
                                
                                <button id="order-export-btn" class="border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-800 dark:text-gray-200 px-4 py-2 rounded-md flex items-center transition duration-300">
                                    <i class="ri-download-line mr-2"></i>
                                    <span>Export</span>
                                </button>
                            </div>
                            
                            <div class="w-full sm:w-auto flex flex-col sm:flex-row gap-2">
                                <div class="relative">
                                    <input id="order-search" type="text" placeholder="Search orders..." class="w-full sm:w-64 pl-10 pr-4 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <i class="ri-search-line absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                </div>
                                
                                <select id="order-status-filter" class="border rounded-md px-3 py-2 text-base focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <option value="">All Statuses</option>
                                    <option value="pending">Pending</option>
                                    <option value="processing">Processing</option>
                                    <option value="completed">Completed</option>
                                    <option value="canceled">Canceled</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Orders Table -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden">
                            <div class="overflow-x-auto">
                                <table class="min-w-full">
                                    <thead>
                                        <tr class="border-b dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50">
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Order ID</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Customer</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Items</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Date</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Total</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Status</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="orders-table-body">
                                        <!-- Order items will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <div id="orders-table-empty" class="hidden py-16 text-center">
                                <i class="ri-inbox-line text-5xl text-gray-300 dark:text-gray-600 mb-3"></i>
                                <p class="text-gray-500 dark:text-gray-400">No orders found.</p>
                            </div>
                            
                            <!-- Pagination -->
                            <div class="px-4 py-3 border-t dark:border-gray-700 flex flex-col xs:flex-row items-center xs:justify-between">
                                <div class="text-sm text-gray-500 dark:text-gray-400 mb-2 xs:mb-0">
                                    Showing <span id="orders-showing-start">1</span> to <span id="orders-showing-end">10</span> of <span id="orders-total">37</span> entries
                                </div>
                                <div class="inline-flex shadow-sm">
                                    <button id="orders-prev-page" class="px-3 py-1 text-sm border dark:border-gray-600 rounded-l hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300">Previous</button>
                                    <button id="orders-next-page" class="px-3 py-1 text-sm border border-l-0 dark:border-gray-600 rounded-r hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300">Next</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Reports & Analytics Page -->
                    <div id="reports-page" class="page hidden">
                        <!-- Report Filters -->
                        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 mb-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Report Filters</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Report Type</label>
                                    <select id="report-type" class="w-full border rounded-md px-3 py-2 text-base focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                        <option value="sales">Sales Report</option>
                                        <option value="stock">Stock Movement Report</option>
                                        <option value="user">User Activity Report</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Date Range</label>
                                    <select id="report-date-range" class="w-full border rounded-md px-3 py-2 text-base focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                        <option value="today">Today</option>
                                        <option value="yesterday">Yesterday</option>
                                        <option value="week">Last 7 Days</option>
                                        <option value="month" selected>Last 30 Days</option>
                                        <option value="quarter">Last Quarter</option>
                                        <option value="year">Last Year</option>
                                        <option value="custom">Custom Range</option>
                                    </select>
                                </div>
                                
                                <div class="flex items-end">
                                    <button id="generate-report-btn" class="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-md flex items-center transition duration-300">
                                        <i class="ri-file-chart-line mr-2"></i>
                                        <span>Generate Report</span>
                                    </button>
                                </div>
                            </div>
                            
                            <div id="custom-date-range" class="mt-4 hidden grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Start Date</label>
                                    <input type="date" id="report-start-date" class="w-full border rounded-md px-3 py-2 text-base focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">End Date</label>
                                    <input type="date" id="report-end-date" class="w-full border rounded-md px-3 py-2 text-base focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Report Result -->
                        <div id="report-content" class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Report Results</h3>
                                <button id="export-report-btn" class="border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-800 dark:text-gray-200 px-3 py-1 rounded-md flex items-center text-sm transition duration-300">
                                    <i class="ri-download-line mr-2"></i>
                                    <span>Export</span>
                                </button>
                            </div>
                            
                            <div id="report-loading" class="py-16 text-center hidden">
                                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 dark:border-primary-500"></div>
                                <p class="mt-2 text-gray-500 dark:text-gray-400">Generating report...</p>
                            </div>
                            
                            <div id="report-placeholder" class="py-16 text-center">
                                <i class="ri-bar-chart-grouped-line text-5xl text-gray-300 dark:text-gray-600 mb-3"></i>
                                <p class="text-gray-500 dark:text-gray-400">Use the filters above to generate a report.</p>
                            </div>
                            
                            <div id="report-results" class="hidden">
                                <!-- Report content will be loaded here -->
                                <div id="report-chart-container" class="w-full h-[400px] mb-6">
                                    <canvas id="report-chart"></canvas>
                                </div>
                                
                                <div id="report-summary" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                    <!-- Summary cards will be loaded here -->
                                </div>
                                
                                <div id="report-table-container" class="overflow-x-auto">
                                    <table class="min-w-full">
                                        <thead id="report-table-head">
                                            <!-- Table headers will be loaded here -->
                                        </thead>
                                        <tbody id="report-table-body">
                                            <!-- Table data will be loaded here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- User Management Page (Admin Only) -->
                    <div id="users-page" class="page hidden">
                        <!-- Action Bar -->
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
                            <div class="flex items-center gap-2">
                                <button id="add-user-btn" class="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-md flex items-center transition duration-300">
                                    <i class="ri-user-add-line mr-2"></i>
                                    <span>Add User</span>
                                </button>
                            </div>
                            
                            <div class="w-full sm:w-auto flex flex-col sm:flex-row gap-2">
                                <div class="relative">
                                    <input id="user-search" type="text" placeholder="Search users..." class="w-full sm:w-64 pl-10 pr-4 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <i class="ri-search-line absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                </div>
                                
                                <select id="user-role-filter" class="border rounded-md px-3 py-2 text-base focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <option value="">All Roles</option>
                                    <option value="admin">Admin</option>
                                    <option value="manager">Manager</option>
                                    <option value="staff">Staff</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Users Table -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden">
                            <div class="overflow-x-auto">
                                <table class="min-w-full">
                                    <thead>
                                        <tr class="border-b dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50">
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">User</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Email</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Role</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Status</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Last Login</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="users-table-body">
                                        <!-- User entries will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <div id="users-table-empty" class="hidden py-16 text-center">
                                <i class="ri-user-3-line text-5xl text-gray-300 dark:text-gray-600 mb-3"></i>
                                <p class="text-gray-500 dark:text-gray-400">No users found.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Settings Page -->
                    <div id="settings-page" class="page hidden">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <!-- System Settings -->
                            <div class="col-span-2">
                                <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">System Settings</h3>
                                    
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Company Name</label>
                                            <input type="text" id="company-name" class="w-full border rounded-md px-3 py-2 text-base focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" value="Inventory Pro Inc.">
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Currency</label>
                                            <select id="currency-setting" class="w-full border rounded-md px-3 py-2 text-base focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                                <option value="USD">US Dollar ($)</option>
                                                <option value="EUR">Euro (€)</option>
                                                <option value="GBP">British Pound (£)</option>
                                                <option value="JPY">Japanese Yen (¥)</option>
                                                <option value="CAD">Canadian Dollar (C$)</option>
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Date Format</label>
                                            <select id="date-format-setting" class="w-full border rounded-md px-3 py-2 text-base focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                                <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                                <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                                                <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                            </select>
                                        </div>
                                        
                                        <div class="flex items-center">
                                            <input type="checkbox" id="enable-low-stock-alerts" class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600" checked>
                                            <label for="enable-low-stock-alerts" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Enable low stock alerts</label>
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Low Stock Threshold</label>
                                            <input type="number" id="low-stock-threshold" class="w-full border rounded-md px-3 py-2 text-base focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" value="10">
                                        </div>
                                    </div>
                                    
                                    <div class="mt-6">
                                        <button id="save-settings-btn" class="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-md flex items-center transition duration-300">
                                            <i class="ri-save-line mr-2"></i>
                                            <span>Save Settings</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Account Settings -->
                            <div>
                                <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 mb-6">
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Account Settings</h3>
                                    
                                    <div class="flex flex-col items-center mb-4">
                                        <div class="w-24 h-24 rounded-full bg-primary-500 flex items-center justify-center text-white text-3xl font-semibold mb-2" id="settings-user-avatar">A</div>
                                        <p class="text-lg font-medium text-gray-900 dark:text-white" id="settings-user-name">Admin User</p>
                                        <p class="text-sm text-gray-500 dark:text-gray-400" id="settings-user-email">admin@example.com</p>
                                    </div>
                                    
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Display Name</label>
                                            <input type="text" id="display-name" class="w-full border rounded-md px-3 py-2 text-base focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" value="Admin User">
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Email</label>
                                            <input type="email" id="user-email" class="w-full border rounded-md px-3 py-2 text-base focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" value="admin@example.com">
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Change Password</label>
                                            <input type="password" id="new-password" class="w-full border rounded-md px-3 py-2 text-base focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="New password">
                                        </div>
                                        
                                        <div>
                                            <input type="password" id="confirm-password" class="w-full border rounded-md px-3 py-2 text-base focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Confirm new password">
                                        </div>
                                    </div>
                                    
                                    <div class="mt-6">
                                        <button id="update-account-btn" class="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-md flex items-center transition duration-300">
                                            <i class="ri-user-settings-line mr-2"></i>
                                            <span>Update Account</span>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Theme</h3>
                                    
                                    <div class="space-y-4">
                                        <div class="flex items-center justify-between">
                                            <span class="text-gray-700 dark:text-gray-300">Dark Mode</span>
                                            <div class="relative">
                                                <input type="checkbox" id="theme-toggle-setting" class="sr-only">
                                                <div class="block bg-gray-300 dark:bg-gray-600 w-14 h-7 rounded-full"></div>
                                                <div class="dot absolute left-1 top-1 bg-white w-5 h-5 rounded-full transition-transform duration-300 transform scale-90"></div>
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Accent Color</label>
                                            <div class="grid grid-cols-5 gap-2 mt-2">
                                                <button class="color-btn w-full h-10 rounded-md border border-gray-200 dark:border-gray-700 bg-purple-600" data-color="purple"></button>
                                                <button class="color-btn w-full h-10 rounded-md border border-gray-200 dark:border-gray-700 bg-blue-600" data-color="blue"></button>
                                                <button class="color-btn w-full h-10 rounded-md border border-gray-200 dark:border-gray-700 bg-green-600" data-color="green"></button>
                                                <button class="color-btn w-full h-10 rounded-md border border-gray-200 dark:border-gray-700 bg-red-600" data-color="red"></button>
                                                <button class="color-btn w-full h-10 rounded-md border border-gray-200 dark:border-gray-700 bg-amber-600" data-color="amber"></button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- Modals -->
    <div id="modal-container" class="hidden fixed inset-0 z-50 overflow-y-auto overflow-x-hidden flex items-center justify-center p-4 bg-black bg-opacity-50">
        <!-- Modal content will be dynamically inserted here -->
    </div>
    
    <!-- Toast Notifications -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 space-y-2 transition-all duration-300"></div>
    
    <script>
        // Check for dark mode preference
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
        
        // MAIN APPLICATION LOGIC
        document.addEventListener('DOMContentLoaded', function() {
            // DATABASE SETUP - Mock data for demonstration
            // In a real app, this would be managed by a proper database
            const db = {
                init() {
                    this.users = [
                        { id: 1, name: 'Admin User', email: 'admin@example.com', password: 'password', role: 'admin', status: 'active', lastLogin: '2023-08-15 08:30:25' },
                        { id: 2, name: 'Manager User', email: 'manager@example.com', password: 'password', role: 'manager', status: 'active', lastLogin: '2023-08-14 09:15:42' },
                        { id: 3, name: 'Staff User', email: 'staff@example.com', password: 'password', role: 'staff', status: 'active', lastLogin: '2023-08-12 16:30:10' },
                        { id: 4, name: 'John Smith', email: 'john@example.com', password: 'password', role: 'staff', status: 'inactive', lastLogin: '2023-06-28 10:45:33' },
                        { id: 5, name: 'Sarah Johnson', email: 'sarah@example.com', password: 'password', role: 'manager', status: 'active', lastLogin: '2023-08-10 14:22:18' },
                    ];
                    
                    this.stockItems = [];
                    this.orders = [];
                    this.customers = [];
                    this.activityLog = [];
                    
                    this.generateMockData();
                },
                
                generateMockData() {
                    // Generate mock stock items
                    const categories = ['electronics', 'clothing', 'furniture', 'office', 'food'];
                    const statusOptions = ['in_stock', 'low_stock', 'out_of_stock'];
                    
                    for (let i = 1; i <= 84; i++) {
                        const category = categories[Math.floor(Math.random() * categories.length)];
                        const quantity = Math.floor(Math.random() * 100);
                        let status = 'in_stock';
                        
                        if (quantity <= 0) {
                            status = 'out_of_stock';
                        } else if (quantity <= 10) {
                            status = 'low_stock';
                        }
                        
                        const item = {
                            id: i,
                            name: this.generateProductName(category),
                            sku: `SKU${String(i).padStart(6, '0')}`,
                            category: category,
                            quantity: quantity,
                            price: (Math.random() * 1000 + 10).toFixed(2),
                            status: status,
                            supplier: `Supplier ${Math.floor(Math.random() * 10) + 1}`,
                            lastUpdated: this.randomDate(new Date(2023, 0, 1), new Date())
                        };
                        
                        this.stockItems.push(item);
                    }
                    
                    // Generate mock customers
                    const firstNames = ['John', 'Jane', 'Robert', 'Sarah', 'Michael', 'Emily', 'David', 'Amanda', 'James', 'Lisa'];
                    const lastNames = ['Smith', 'Johnson', 'Williams', 'Brown', 'Jones', 'Miller', 'Davis', 'Garcia', 'Wilson', 'Lee'];
                    
                    for (let i = 1; i <= 50; i++) {
                        const firstName = firstNames[Math.floor(Math.random() * firstNames.length)];
                        const lastName = lastNames[Math.floor(Math.random() * lastNames.length)];
                        
                        const customer = {
                            id: i,
                            name: `${firstName} ${lastName}`,
                            email: `${firstName.toLowerCase()}.${lastName.toLowerCase()}@example.com`,
                            phone: `(${Math.floor(Math.random() * 900) + 100}) ${Math.floor(Math.random() * 900) + 100}-${Math.floor(Math.random() * 9000) + 1000}`,
                            address: `${Math.floor(Math.random() * 9000) + 1000} Main St, City, ST ${Math.floor(Math.random() * 90000) + 10000}`
                        };
                        
                        this.customers.push(customer);
                    }
                    
                    // Generate mock orders
                    const orderStatuses = ['pending', 'processing', 'completed', 'canceled'];
                    
                    for (let i = 1; i <= 37; i++) {
                        const itemCount = Math.floor(Math.random() * 5) + 1;
                        const items = [];
                        let total = 0;
                        
                        for (let j = 0; j < itemCount; j++) {
                            const stockItem = this.stockItems[Math.floor(Math.random() * this.stockItems.length)];
                            const quantity = Math.floor(Math.random() * 5) + 1;
                            const price = parseFloat(stockItem.price);
                            const subtotal = price * quantity;
                            
                            items.push({
                                id: stockItem.id,
                                name: stockItem.name,
                                quantity: quantity,
                                price: price,
                                subtotal: subtotal
                            });
                            
                            total += subtotal;
                        }
                        
                        const date = this.randomDate(new Date(2023, 0, 1), new Date());
                        const status = orderStatuses[Math.floor(Math.random() * orderStatuses.length)];
                        const customer = this.customers[Math.floor(Math.random() * this.customers.length)];
                        
                        const order = {
                            id: `ORD${String(i).padStart(5, '0')}`,
                            customerId: customer.id,
                            customerName: customer.name,
                            date: date,
                            items: items,
                            total: total,
                            status: status,
                            paymentMethod: Math.random() > 0.5 ? 'Credit Card' : 'PayPal',
                            notes: ''
                        };
                        
                        this.orders.push(order);
                    }
                    
                    // Generate mock activity log
                    const actionTypes = ['login', 'logout', 'add_stock', 'update_stock', 'add_order', 'update_order', 'update_settings'];
                    const userIds = [1, 2, 3, 5];
                    
                    for (let i = 1; i <= 50; i++) {
                        const userId = userIds[Math.floor(Math.random() * userIds.length)];
                        const user = this.users.find(u => u.id === userId);
                        const actionType = actionTypes[Math.floor(Math.random() * actionTypes.length)];
                        const date = this.randomDate(new Date(2023, 7, 1), new Date());
                        
                        let details = '';
                        switch (actionType) {
                            case 'login':
                                details = 'User logged in';
                                break;
                            case 'logout':
                                details = 'User logged out';
                                break;
                            case 'add_stock':
                                const newItem = this.stockItems[Math.floor(Math.random() * this.stockItems.length)];
                                details = `Added new stock item: ${newItem.name}`;
                                break;
                            case 'update_stock':
                                const updatedItem = this.stockItems[Math.floor(Math.random() * this.stockItems.length)];
                                details = `Updated stock item: ${updatedItem.name}`;
                                break;
                            case 'add_order':
                                const newOrder = this.orders[Math.floor(Math.random() * this.orders.length)];
                                details = `Created new order: ${newOrder.id}`;
                                break;
                            case 'update_order':
                                const updatedOrder = this.orders[Math.floor(Math.random() * this.orders.length)];
                                details = `Updated order status to ${updatedOrder.status}: ${updatedOrder.id}`;
                                break;
                            case 'update_settings':
                                details = 'Updated system settings';
                                break;
                        }
                        
                        const activity = {
                            id: i,
                            userId: userId,
                            userName: user.name,
                            actionType: actionType,
                            details: details,
                            timestamp: date
                        };
                        
                        this.activityLog.push(activity);
                    }
                    
                    // Sort activity log by timestamp (newest first)
                    this.activityLog.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                },
                
                generateProductName(category) {
                    const names = {
                        'electronics': [
                            'Smart TV 43"', 'Smart TV 50"', 'Smart TV 55"', 'Smart TV 65"', 
                            'Smartphone A1', 'Smartphone A2', 'Smartphone Pro', 'Smartphone Max',
                            'Laptop Basic', 'Laptop Pro', 'Laptop Ultra', 'Laptop Gaming',
                            'Wireless Earbuds', 'Bluetooth Speaker', 'Wireless Headphones', 'Gaming Headset',
                            'Desktop PC', 'Gaming PC', 'Tablet 10"', 'Tablet 12"'
                        ],
                        'clothing': [
                            'T-Shirt Basic', 'T-Shirt Premium', 'Polo Shirt', 'Button-Up Shirt',
                            'Jeans Regular', 'Jeans Slim', 'Chino Pants', 'Dress Pants',
                            'Hoodie', 'Sweatshirt', 'Jacket', 'Winter Coat',
                            'Dress Socks', 'Athletic Socks', 'Boxers', 'Briefs',
                            'Baseball Cap', 'Beanie', 'Gloves', 'Scarf'
                        ],
                        'furniture': [
                            'Sofa 3-Seat', 'Sofa 2-Seat', 'Armchair', 'Ottoman',
                            'Coffee Table', 'End Table', 'Console Table', 'Dining Table',
                            'Dining Chair', 'Bar Stool', 'Office Chair', 'Desk Chair',
                            'Bookshelf', 'TV Stand', 'Wardrobe', 'Dresser',
                            'Bed Frame Queen', 'Bed Frame King', 'Nightstand', 'Mattress'
                        ],
                        'office': [
                            'Printer', 'Scanner', 'All-in-One Printer', 'Paper Shredder',
                            'Desk Lamp', 'Desk Organizer', 'File Cabinet', 'Bookends',
                            'Notebook', 'Planner', 'Sticky Notes', 'Pens (Pack)',
                            'Markers (Pack)', 'Pencils (Pack)', 'Stapler', 'Paper Clips',
                            'Scissors', 'Tape Dispenser', 'Envelopes', 'Printer Paper'
                        ],
                        'food': [
                            'Coffee Beans', 'Tea Bags', 'Hot Chocolate', 'Energy Drinks',
                            'Pasta', 'Rice', 'Cereal', 'Oatmeal',
                            'Canned Soup', 'Canned Vegetables', 'Canned Fruit', 'Canned Tuna',
                            'Crackers', 'Chips', 'Popcorn', 'Pretzels',
                            'Cookies', 'Chocolate Bars', 'Granola Bars', 'Trail Mix'
                        ]
                    };
                    
                    const categoryNames = names[category] || names['electronics'];
                    return categoryNames[Math.floor(Math.random() * categoryNames.length)];
                },
                
                randomDate(start, end) {
                    const diff = end.getTime() - start.getTime();
                    const newDiff = Math.random() * diff;
                    const date = new Date(start.getTime() + newDiff);
                    
                    return date.toISOString().split('T')[0] + ' ' + 
                        String(date.getHours()).padStart(2, '0') + ':' +
                        String(date.getMinutes()).padStart(2, '0') + ':' +
                        String(date.getSeconds()).padStart(2, '0');
                }
            };
            
            db.init();
            
            // UTILITIES
            const util = {
                formatDate(dateString, format = 'MM/DD/YYYY') {
                    if (!dateString) return '';
                    
                    const date = new Date(dateString);
                    if (isNaN(date.getTime())) return dateString;
                    
                    const day = String(date.getDate()).padStart(2, '0');
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const year = date.getFullYear();
                    
                    switch (format) {
                        case 'MM/DD/YYYY':
                            return `${month}/${day}/${year}`;
                        case 'DD/MM/YYYY':
                            return `${day}/${month}/${year}`;
                        case 'YYYY-MM-DD':
                            return `${year}-${month}-${day}`;
                        default:
                            return `${month}/${day}/${year}`;
                    }
                },
                
                formatCurrency(amount, currency = 'USD') {
                    const formatter = new Intl.NumberFormat('en-US', {
                        style: 'currency',
                        currency: currency
                    });
                    
                    return formatter.format(amount);
                },
                
                formatTime(dateString) {
                    if (!dateString) return '';
                    
                    const date = new Date(dateString);
                    if (isNaN(date.getTime())) return '';
                    
                    const hours = String(date.getHours()).padStart(2, '0');
                    const minutes = String(date.getMinutes()).padStart(2, '0');
                    
                    return `${hours}:${minutes}`;
                },
                
                capitalize(string) {
                    if (!string) return '';
                    return string.charAt(0).toUpperCase() + string.slice(1);
                },
                
                debounce(func, wait) {
                    let timeout;
                    return function executedFunction(...args) {
                        const later = () => {
                            clearTimeout(timeout);
                            func(...args);
                        };
                        
                        clearTimeout(timeout);
                        timeout = setTimeout(later, wait);
                    };
                },
                
                showToast(message, type = 'success', duration = 3000) {
                    const toastContainer = document.getElementById('toast-container');
                    
                    const toast = document.createElement('div');
                    toast.className = `p-4 rounded-md shadow-md flex items-center max-w-md transition-all duration-300 transform translate-y-2 opacity-0`;
                    
                    let bgClass, iconClass;
                    
                    switch (type) {
                        case 'success':
                            bgClass = 'bg-green-600 text-white';
                            iconClass = 'ri-check-line';
                            break;
                        case 'error':
                            bgClass = 'bg-red-600 text-white';
                            iconClass = 'ri-error-warning-line';
                            break;
                        case 'warning':
                            bgClass = 'bg-amber-500 text-white';
                            iconClass = 'ri-alert-line';
                            break;
                        case 'info':
                            bgClass = 'bg-blue-600 text-white';
                            iconClass = 'ri-information-line';
                            break;
                        default:
                            bgClass = 'bg-green-600 text-white';
                            iconClass = 'ri-check-line';
                    }
                    
                    toast.classList.add(...bgClass.split(' '));
                    
                    toast.innerHTML = `
                        <i class="${iconClass} mr-2 text-lg"></i>
                        <span>${message}</span>
                        <button class="ml-auto text-white hover:text-gray-200" onclick="this.parentNode.remove()">
                            <i class="ri-close-line"></i>
                        </button>
                    `;
                    
                    toastContainer.appendChild(toast);
                    
                    // Trigger reflow and add appearance classes
                    setTimeout(() => {
                        toast.classList.remove('translate-y-2', 'opacity-0');
                    }, 10);
                    
                    // Remove the toast after duration
                    setTimeout(() => {
                        toast.classList.add('translate-y-2', 'opacity-0');
                        
                        setTimeout(() => {
                            toastContainer.removeChild(toast);
                        }, 300);
                    }, duration);
                },
                
                showModal(title, content, buttons = []) {
                    const modalContainer = document.getElementById('modal-container');
                    
                    // Create modal HTML
                    const modalHTML = `
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md transform transition-all">
                            <div class="px-6 pt-6 pb-4">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-xl font-semibold text-gray-900 dark:text-white">${title}</h3>
                                    <button class="text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 modal-close">
                                        <i class="ri-close-line text-xl"></i>
                                    </button>
                                </div>
                                <div class="modal-content">
                                    ${content}
                                </div>
                            </div>
                            ${buttons.length > 0 ? `
                                <div class="px-6 py-4 bg-gray-50 dark:bg-gray-700 rounded-b-lg flex justify-end gap-3">
                                    ${buttons.map(btn => `
                                        <button class="${btn.class}">${btn.text}</button>
                                    `).join('')}
                                </div>
                            ` : ''}
                        </div>
                    `;
                    
                    // Insert modal into container
                    modalContainer.innerHTML = modalHTML;
                    
                    // Show modal
                    modalContainer.classList.remove('hidden');
                    
                    // Add event listeners
                    modalContainer.querySelector('.modal-close').addEventListener('click', () => {
                        this.closeModal();
                    });
                    
                    // Add button event listeners
                    buttons.forEach((btn, index) => {
                        if (btn.onClick) {
                            const buttonElement = modalContainer.querySelectorAll('.px-6.py-4 button')[index];
                            buttonElement.addEventListener('click', btn.onClick);
                        }
                    });
                    
                    // Close modal when clicking outside
                    modalContainer.addEventListener('click', (e) => {
                        if (e.target === modalContainer) {
                            this.closeModal();
                        }
                    });
                    
                    return modalContainer;
                },
                
                closeModal() {
                    const modalContainer = document.getElementById('modal-container');
                    modalContainer.classList.add('hidden');
                    modalContainer.innerHTML = '';
                }
            };
            
            // AUTH MANAGEMENT
            const auth = {
                currentUser: null,
                
                login(email, password) {
                    const user = db.users.find(u => u.email === email && u.password === password);
                    
                    if (user) {
                        this.currentUser = user;
                        
                        // Add login activity
                        db.activityLog.unshift({
                            id: db.activityLog.length + 1,
                            userId: user.id,
                            userName: user.name,
                            actionType: 'login',
                            details: 'User logged in',
                            timestamp: new Date().toISOString().replace('T', ' ').split('.')[0]
                        });
                        
                        return true;
                    }
                    
                    return false;
                },
                
                logout() {
                    if (this.currentUser) {
                        // Add logout activity
                        db.activityLog.unshift({
                            id: db.activityLog.length + 1,
                            userId: this.currentUser.id,
                            userName: this.currentUser.name,
                            actionType: 'logout',
                            details: 'User logged out',
                            timestamp: new Date().toISOString().replace('T', ' ').split('.')[0]
                        });
                        
                        this.currentUser = null;
                    }
                },
                
                isAdmin() {
                    return this.currentUser && this.currentUser.role === 'admin';
                },
                
                isManager() {
                    return this.currentUser && (this.currentUser.role === 'admin' || this.currentUser.role === 'manager');
                }
            };
            
            // UI MANAGEMENT
            const ui = {
                currentPage: 'dashboard',
                
                init() {
                    this.setupEventListeners();
                    this.setupThemeToggle();
                },
                
                setupEventListeners() {
                    // Login Form
                    document.getElementById('login-btn').addEventListener('click', () => {
                        const email = document.getElementById('email').value;
                        const password = document.getElementById('password').value;
                        
                        if (auth.login(email, password)) {
                            this.showMainApp();
                            this.updateUserInfo();
                            
                            // Navigate to dashboard
                            this.navigateTo('dashboard');
                            
                            util.showToast(`Welcome, ${auth.currentUser.name}!`, 'success');
                        } else {
                            util.showToast('Invalid email or password', 'error');
                        }
                    });
                    
                    // Logout
                    document.getElementById('logout-btn').addEventListener('click', () => {
                        auth.logout();
                        this.showLoginScreen();
                        util.showToast('You have been logged out', 'info');
                    });
                    
                    // Navigation
                    document.querySelectorAll('.nav-link').forEach(link => {
                        link.addEventListener('click', (e) => {
                            e.preventDefault();
                            const page = link.getAttribute('href').substring(1);
                            this.navigateTo(page);
                        });
                    });
                    
                    // Mobile menu toggle
                    document.getElementById('mobile-menu-toggle').addEventListener('click', () => {
                        const sidebarContent = document.getElementById('sidebar-content');
                        sidebarContent.classList.toggle('hidden');
                        sidebarContent.classList.toggle('md:block');
                    });
                    
                    // Theme toggle
                    document.getElementById('theme-toggle').addEventListener('click', () => {
                        document.documentElement.classList.toggle('dark');
                    });
                    
                    // Settings page theme toggle
                    document.getElementById('theme-toggle-setting').addEventListener('change', (e) => {
                        if (e.target.checked) {
                            document.documentElement.classList.add('dark');
                        } else {
                            document.documentElement.classList.remove('dark');
                        }
                    });
                    
                    // Save settings
                    document.getElementById('save-settings-btn').addEventListener('click', () => {
                        util.showToast('Settings saved successfully', 'success');
                    });
                    
                    // Update account
                    document.getElementById('update-account-btn').addEventListener('click', () => {
                        const displayName = document.getElementById('display-name').value;
                        const userEmail = document.getElementById('user-email').value;
                        const newPassword = document.getElementById('new-password').value;
                        const confirmPassword = document.getElementById('confirm-password').value;
                        
                        if (newPassword && newPassword !== confirmPassword) {
                            util.showToast('Passwords do not match', 'error');
                            return;
                        }
                        
                        // Update user
                        if (auth.currentUser) {
                            auth.currentUser.name = displayName;
                            auth.currentUser.email = userEmail;
                            
                            if (newPassword) {
                                auth.currentUser.password = newPassword;
                            }
                            
                            this.updateUserInfo();
                            util.showToast('Account updated successfully', 'success');
                            
                            // Clear password fields
                            document.getElementById('new-password').value = '';
                            document.getElementById('confirm-password').value = '';
                        }
                    });
                    
                    // Color buttons in settings
                    document.querySelectorAll('.color-btn').forEach(btn => {
                        btn.addEventListener('click', () => {
                            const color = btn.getAttribute('data-color');
                            document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('ring-2', 'ring-offset-2'));
                            btn.classList.add('ring-2', 'ring-offset-2');
                            
                            // Here you would apply the color theme
                            util.showToast(`Color theme updated to ${color}`, 'success');
                        });
                    });
                    
                    // Stock Management
                    document.getElementById('add-stock-btn').addEventListener('click', () => {
                        stockManagement.showAddStockModal();
                    });
                    
                    document.getElementById('stock-search').addEventListener('input', util.debounce((e) => {
                        stockManagement.filterItems();
                    }, 300));
                    
                    document.getElementById('stock-category-filter').addEventListener('change', () => {
                        stockManagement.filterItems();
                    });
                    
                    document.getElementById('stock-prev-page').addEventListener('click', () => {
                        stockManagement.prevPage();
                    });
                    
                    document.getElementById('stock-next-page').addEventListener('click', () => {
                        stockManagement.nextPage();
                    });
                    
                    document.getElementById('stock-export-btn').addEventListener('click', () => {
                        util.showToast('Stock data export started', 'info');
                        
                        setTimeout(() => {
                            util.showToast('Export completed! Right-click and use "Save As" to download the data', 'success');
                        }, 1500);
                    });
                    
                    // Order Management
                    document.getElementById('add-order-btn').addEventListener('click', () => {
                        orderManagement.showAddOrderModal();
                    });
                    
                    document.getElementById('order-search').addEventListener('input', util.debounce((e) => {
                        orderManagement.filterOrders();
                    }, 300));
                    
                    document.getElementById('order-status-filter').addEventListener('change', () => {
                        orderManagement.filterOrders();
                    });
                    
                    document.getElementById('orders-prev-page').addEventListener('click', () => {
                        orderManagement.prevPage();
                    });
                    
                    document.getElementById('orders-next-page').addEventListener('click', () => {
                        orderManagement.nextPage();
                    });
                    
                    document.getElementById('order-export-btn').addEventListener('click', () => {
                        util.showToast('Order data export started', 'info');
                        
                        setTimeout(() => {
                            util.showToast('Export completed! Right-click and use "Save As" to download the data', 'success');
                        }, 1500);
                    });
                    
                    // Reports
                    document.getElementById('report-date-range').addEventListener('change', (e) => {
                        const customDateRange = document.getElementById('custom-date-range');
                        if (e.target.value === 'custom') {
                            customDateRange.classList.remove('hidden');
                        } else {
                            customDateRange.classList.add('hidden');
                        }
                    });
                    
                    document.getElementById('generate-report-btn').addEventListener('click', () => {
                        reportsManagement.generateReport();
                    });
                    
                    document.getElementById('export-report-btn').addEventListener('click', () => {
                        util.showToast('Report export started', 'info');
                        
                        setTimeout(() => {
                            util.showToast('Export completed! Right-click and use "Save As" to download the report', 'success');
                        }, 1500);
                    });
                    
                    // User Management
                    document.getElementById('add-user-btn').addEventListener('click', () => {
                        userManagement.showAddUserModal();
                    });
                    
                    document.getElementById('user-search').addEventListener('input', util.debounce((e) => {
                        userManagement.filterUsers();
                    }, 300));
                    
                    document.getElementById('user-role-filter').addEventListener('change', () => {
                        userManagement.filterUsers();
                    });
                    
                    // Global search
                    document.getElementById('global-search').addEventListener('input', util.debounce((e) => {
                        const searchTerm = e.target.value.toLowerCase().trim();
                        
                        if (searchTerm.length >= 2) {
                            // Implement global search functionality
                            util.showToast(`Searching for: ${searchTerm}`, 'info');
                        }
                    }, 500));
                },
                
                setupThemeToggle() {
                    const themeToggle = document.getElementById('theme-toggle-setting');
                    const toggleDot = document.querySelector('.dot');
                    
                    // Update toggle state based on current theme
                    if (document.documentElement.classList.contains('dark')) {
                        themeToggle.checked = true;
                        toggleDot.classList.add('translate-x-7');
                    }
                    
                    // Handle toggle change
                    themeToggle.addEventListener('change', (e) => {
                        if (e.target.checked) {
                            toggleDot.classList.add('translate-x-7');
                            document.documentElement.classList.add('dark');
                        } else {
                            toggleDot.classList.remove('translate-x-7');
                            document.documentElement.classList.remove('dark');
                        }
                    });
                },
                
                showLoginScreen() {
                    document.getElementById('login-container').classList.remove('hidden');
                    document.getElementById('main-container').classList.add('hidden');
                },
                
                showMainApp() {
                    document.getElementById('login-container').classList.add('hidden');
                    document.getElementById('main-container').classList.remove('hidden');
                    
                    // Initialize dashboard when showing main app
                    this.refreshDashboard();
                },
                
                updateUserInfo() {
                    if (!auth.currentUser) return;
                    
                    // Update sidebar user info
                    document.getElementById('user-name').textContent = auth.currentUser.name;
                    document.getElementById('user-role').textContent = util.capitalize(auth.currentUser.role);
                    document.getElementById('user-avatar').textContent = auth.currentUser.name.charAt(0);
                    
                    // Update settings form
                    document.getElementById('display-name').value = auth.currentUser.name;
                    document.getElementById('user-email').value = auth.currentUser.email;
                    document.getElementById('settings-user-name').textContent = auth.currentUser.name;
                    document.getElementById('settings-user-email').textContent = auth.currentUser.email;
                    document.getElementById('settings-user-avatar').textContent = auth.currentUser.name.charAt(0);
                    
                    // Show/hide admin sections based on role
                    if (auth.isAdmin()) {
                        document.getElementById('admin-nav-section').classList.remove('hidden');
                    } else {
                        document.getElementById('admin-nav-section').classList.add('hidden');
                    }
                },
                
                navigateTo(page) {
                    // Don't do anything if it's the same page
                    if (this.currentPage === page) return;
                    
                    // Update active navigation link
                    document.querySelectorAll('.nav-link').forEach(link => {
                        link.classList.remove('active-nav', 'bg-gray-100', 'dark:bg-gray-700', 'text-primary-600', 'dark:text-primary-500');
                        
                        if (link.getAttribute('href') === `#${page}`) {
                            link.classList.add('active-nav', 'bg-gray-100', 'dark:bg-gray-700', 'text-primary-600', 'dark:text-primary-500');
                        }
                    });
                    
                    // Hide mobile menu after navigation on mobile
                    if (window.innerWidth < 768) {
                        document.getElementById('sidebar-content').classList.add('hidden');
                    }
                    
                    // Update page title and subtitle
                    const titleElement = document.getElementById('page-title');
                    const subtitleElement = document.getElementById('page-subtitle');
                    
                    switch (page) {
                        case 'dashboard':
                            titleElement.textContent = 'Dashboard';
                            subtitleElement.textContent = 'Welcome to your inventory management system';
                            break;
                        case 'stock':
                            titleElement.textContent = 'Stock Management';
                            subtitleElement.textContent = 'Manage your inventory items';
                            break;
                        case 'orders':
                            titleElement.textContent = 'Order Management';
                            subtitleElement.textContent = 'Track and manage customer orders';
                            break;
                        case 'reports':
                            titleElement.textContent = 'Reports & Analytics';
                            subtitleElement.textContent = 'Generate insights from your data';
                            break;
                        case 'users':
                            titleElement.textContent = 'User Management';
                            subtitleElement.textContent = 'Manage system users and permissions';
                            break;
                        case 'settings':
                            titleElement.textContent = 'Settings';
                            subtitleElement.textContent = 'Configure your system preferences';
                            break;
                    }
                    
                    // Show the selected page
                    document.querySelectorAll('.page').forEach(pageElement => {
                        pageElement.classList.add('hidden');
                    });
                    
                    const targetPage = document.getElementById(`${page}-page`);
                    targetPage.classList.remove('hidden');
                    
                    // Add animation classes
                    targetPage.classList.add('page-enter');
                    setTimeout(() => {
                        targetPage.classList.add('page-enter-active');
                    }, 10);
                    
                    // Remove animation classes after animation completes
                    setTimeout(() => {
                        targetPage.classList.remove('page-enter', 'page-enter-active');
                    }, 300);
                    
                    // Initialize page content based on the page
                    switch (page) {
                        case 'dashboard':
                            this.refreshDashboard();
                            break;
                        case 'stock':
                            stockManagement.loadItems();
                            break;
                        case 'orders':
                            orderManagement.loadOrders();
                            break;
                        case 'reports':
                            // Reports page is initialized when the generate button is clicked
                            break;
                        case 'users':
                            userManagement.loadUsers();
                            break;
                        case 'settings':
                            // Settings page doesn't need special initialization
                            break;
                    }
                    
                    this.currentPage = page;
                },
                
                refreshDashboard() {
                    // Update stats
                    document.getElementById('total-stock-count').textContent = db.stockItems.length;
                    
                    const lowStockItems = db.stockItems.filter(item => item.status === 'low_stock').length;
                    document.getElementById('low-stock-count').textContent = lowStockItems;
                    
                    const completedOrders = db.orders.filter(order => order.status === 'completed').length;
                    document.getElementById('completed-orders-count').textContent = completedOrders;
                    
                    const pendingOrders = db.orders.filter(order => order.status === 'pending').length;
                    document.getElementById('pending-orders-count').textContent = pendingOrders;
                    
                    // Update recent activity
                    const activityContainer = document.getElementById('activity-log-container');
                    activityContainer.innerHTML = '';
                    
                    const recentActivities = db.activityLog.slice(0, 10);
                    
                    recentActivities.forEach(activity => {
                        const row = document.createElement('tr');
                        row.className = 'border-b dark:border-gray-700';
                        
                        let actionIcon = '';
                        switch (activity.actionType) {
                            case 'login':
                                actionIcon = `<i class="ri-login-circle-line text-blue-500 dark:text-blue-400"></i>`;
                                break;
                            case 'logout':
                                actionIcon = `<i class="ri-logout-circle-line text-gray-500 dark:text-gray-400"></i>`;
                                break;
                            case 'add_stock':
                                actionIcon = `<i class="ri-archive-line text-green-500 dark:text-green-400"></i>`;
                                break;
                            case 'update_stock':
                                actionIcon = `<i class="ri-edit-line text-amber-500 dark:text-amber-400"></i>`;
                                break;
                            case 'add_order':
                                actionIcon = `<i class="ri-shopping-cart-line text-purple-500 dark:text-purple-400"></i>`;
                                break;
                            case 'update_order':
                                actionIcon = `<i class="ri-exchange-line text-primary-500 dark:text-primary-400"></i>`;
                                break;
                            case 'update_settings':
                                actionIcon = `<i class="ri-settings-line text-gray-500 dark:text-gray-400"></i>`;
                                break;
                        }
                        
                        const date = new Date(activity.timestamp);
                        const formattedDate = util.formatDate(date);
                        const formattedTime = util.formatTime(date);
                        
                        row.innerHTML = `
                            <td class="px-4 py-3">
                                <div class="flex items-center">
                                    <span class="mr-2">${actionIcon}</span>
                                    <span class="text-gray-900 dark:text-white">${util.capitalize(activity.actionType.replace('_', ' '))}</span>
                                </div>
                            </td>
                            <td class="px-4 py-3 text-gray-900 dark:text-white">${activity.userName}</td>
                            <td class="px-4 py-3 text-gray-500 dark:text-gray-400">${formattedDate} ${formattedTime}</td>
                            <td class="px-4 py-3 text-gray-700 dark:text-gray-300">${activity.details}</td>
                        `;
                        
                        activityContainer.appendChild(row);
                    });
                    
                    // Initialize charts
                    this.initSalesChart();
                    this.initCategoryChart();
                },
                
                initSalesChart() {
                    const salesCanvas = document.getElementById('sales-chart');
                    
                    // Generate monthly sales data for the chart
                    const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                    const currentMonth = new Date().getMonth();
                    
                    const salesData = [];
                    const targetData = [];
                    
                    for (let i = 0; i < 12; i++) {
                        if (i <= currentMonth) {
                            // Mock data for past months
                            const sales = Math.floor(Math.random() * 50000) + 10000;
                            salesData.push(sales);
                            
                            // Target is usually higher than actual sales
                            const target = Math.floor(sales * (1 + Math.random() * 0.5));
                            targetData.push(target);
                        } else {
                            // Future months have no sales yet
                            salesData.push(null);
                            
                            // But might have targets
                            const target = Math.floor(Math.random() * 50000) + 20000;
                            targetData.push(target);
                        }
                    }
                    
                    // Check if the chart already exists, destroy it
                    if (window.salesChart) {
                        window.salesChart.destroy();
                    }
                    
                    // Create the chart
                    window.salesChart = new Chart(salesCanvas, {
                        type: 'line',
                        data: {
                            labels: months,
                            datasets: [
                                {
                                    label: 'Sales',
                                    data: salesData,
                                    borderColor: '#8b5cf6',
                                    backgroundColor: 'rgba(139, 92, 246, 0.1)',
                                    borderWidth: 2,
                                    fill: true,
                                    tension: 0.3
                                },
                                {
                                    label: 'Target',
                                    data: targetData,
                                    borderColor: '#94a3b8',
                                    borderWidth: 2,
                                    borderDash: [5, 5],
                                    pointStyle: false,
                                    fill: false
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    labels: {
                                        color: document.documentElement.classList.contains('dark') ? '#e2e8f0' : '#334155'
                                    }
                                },
                                tooltip: {
                                    mode: 'index',
                                    intersect: false
                                }
                            },
                            scales: {
                                x: {
                                    grid: {
                                        display: false,
                                        color: document.documentElement.classList.contains('dark') ? '#475569' : '#e2e8f0'
                                    },
                                    ticks: {
                                        color: document.documentElement.classList.contains('dark') ? '#94a3b8' : '#64748b'
                                    }
                                },
                                y: {
                                    grid: {
                                        color: document.documentElement.classList.contains('dark') ? '#334155' : '#e2e8f0'
                                    },
                                    ticks: {
                                        color: document.documentElement.classList.contains('dark') ? '#94a3b8' : '#64748b',
                                        callback: function(value) {
                                            return '$' + value.toLocaleString();
                                        }
                                    }
                                }
                            }
                        }
                    });
                },
                
                initCategoryChart() {
                    const categoryCanvas = document.getElementById('category-chart');
                    
                    // Count items by category
                    const categoryCounts = {};
                    db.stockItems.forEach(item => {
                        if (!categoryCounts[item.category]) {
                            categoryCounts[item.category] = 0;
                        }
                        categoryCounts[item.category]++;
                    });
                    
                    const labels = Object.keys(categoryCounts).map(key => util.capitalize(key));
                    const data = Object.values(categoryCounts);
                    
                    // Generate colors for each category
                    const colors = [
                        '#8b5cf6', // Purple
                        '#3b82f6', // Blue
                        '#10b981', // Green
                        '#f59e0b', // Amber
                        '#ef4444'  // Red
                    ];
                    
                    // Check if the chart already exists, destroy it
                    if (window.categoryChart) {
                        window.categoryChart.destroy();
                    }
                    
                    // Create the chart
                    window.categoryChart = new Chart(categoryCanvas, {
                        type: 'doughnut',
                        data: {
                            labels: labels,
                            datasets: [{
                                data: data,
                                backgroundColor: colors,
                                borderWidth: 0
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'right',
                                    labels: {
                                        color: document.documentElement.classList.contains('dark') ? '#e2e8f0' : '#334155',
                                        padding: 15,
                                        font: {
                                            size: 12
                                        }
                                    }
                                }
                            },
                            cutout: '65%'
                        }
                    });
                }
            };
            
            // STOCK MANAGEMENT
            const stockManagement = {
                items: [],
                filteredItems: [],
                currentPage: 1,
                itemsPerPage: 10,
                
                init() {
                    this.loadItems();
                },
                
                loadItems() {
                    this.items = [...db.stockItems];
                    this.filterItems();
                },
                
                filterItems() {
                    const searchTerm = document.getElementById('stock-search').value.toLowerCase();
                    const categoryFilter = document.getElementById('stock-category-filter').value;
                    
                    this.filteredItems = this.items.filter(item => {
                        // Apply search filter
                        const matchesSearch = 
                            item.name.toLowerCase().includes(searchTerm) ||
                            item.sku.toLowerCase().includes(searchTerm) ||
                            item.supplier.toLowerCase().includes(searchTerm);
                        
                        // Apply category filter
                        const matchesCategory = !categoryFilter || item.category === categoryFilter;
                        
                        return matchesSearch && matchesCategory;
                    });
                    
                    this.currentPage = 1;
                    this.renderItems();
                },
                
                renderItems() {
                    const tableBody = document.getElementById('stock-table-body');
                    const emptyMessage = document.getElementById('stock-table-empty');
                    
                    // Calculate pagination
                    const startIndex = (this.currentPage - 1) * this.itemsPerPage;
                    const endIndex = startIndex + this.itemsPerPage;
                    const paginatedItems = this.filteredItems.slice(startIndex, endIndex);
                    
                    // Update pagination info
                    document.getElementById('stock-showing-start').textContent = this.filteredItems.length > 0 ? startIndex + 1 : 0;
                    document.getElementById('stock-showing-end').textContent = Math.min(endIndex, this.filteredItems.length);
                    document.getElementById('stock-total').textContent = this.filteredItems.length;
                    
                    // Enable/disable pagination buttons
                    document.getElementById('stock-prev-page').disabled = this.currentPage === 1;
                    document.getElementById('stock-prev-page').classList.toggle('opacity-50', this.currentPage === 1);
                    
                    document.getElementById('stock-next-page').disabled = endIndex >= this.filteredItems.length;
                    document.getElementById('stock-next-page').classList.toggle('opacity-50', endIndex >= this.filteredItems.length);
                    
                    // Clear table
                    tableBody.innerHTML = '';
                    
                    // Show empty message if no items
                    if (paginatedItems.length === 0) {
                        emptyMessage.classList.remove('hidden');
                    } else {
                        emptyMessage.classList.add('hidden');
                        
                        // Render items
                        paginatedItems.forEach(item => {
                            const row = document.createElement('tr');
                            row.className = 'border-b dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50';
                            
                            // Determine status badge style
                            let statusBadge = '';
                            switch (item.status) {
                                case 'in_stock':
                                    statusBadge = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-500">
                                        <svg class="-ml-0.5 mr-1.5 h-2 w-2 text-green-400" fill="currentColor" viewBox="0 0 8 8">
                                            <circle cx="4" cy="4" r="3" />
                                        </svg>
                                        In Stock
                                    </span>`;
                                    break;
                                case 'low_stock':
                                    statusBadge = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-500">
                                        <svg class="-ml-0.5 mr-1.5 h-2 w-2 text-amber-400" fill="currentColor" viewBox="0 0 8 8">
                                            <circle cx="4" cy="4" r="3" />
                                        </svg>
                                        Low Stock
                                    </span>`;
                                    break;
                                case 'out_of_stock':
                                    statusBadge = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-500">
                                        <svg class="-ml-0.5 mr-1.5 h-2 w-2 text-red-400" fill="currentColor" viewBox="0 0 8 8">
                                            <circle cx="4" cy="4" r="3" />
                                        </svg>
                                        Out of Stock
                                    </span>`;
                                    break;
                            }
                            
                            row.innerHTML = `
                                <td class="px-4 py-3">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 flex-shrink-0 rounded-md bg-gray-200 dark:bg-gray-700 flex items-center justify-center mr-3">
                                            <i class="ri-shopping-bag-line text-gray-500 dark:text-gray-400"></i>
                                        </div>
                                        <div>
                                            <p class="text-sm font-medium text-gray-900 dark:text-white">${item.name}</p>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">${item.supplier}</p>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">${item.sku}</td>
                                <td class="px-4 py-3 text-sm text-gray-900 dark:text-white capitalize">${item.category}</td>
                                <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">${item.quantity}</td>
                                <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">${util.formatCurrency(item.price)}</td>
                                <td class="px-4 py-3 text-sm">${statusBadge}</td>
                                <td class="px-4 py-3 text-sm">
                                    <div class="flex items-center space-x-2">
                                        <button class="text-primary-600 dark:text-primary-400 hover:text-primary-800 dark:hover:text-primary-300" data-action="edit" data-id="${item.id}">
                                            <i class="ri-edit-line"></i>
                                        </button>
                                        <button class="text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300" data-action="delete" data-id="${item.id}">
                                            <i class="ri-delete-bin-line"></i>
                                        </button>
                                    </div>
                                </td>
                            `;
                            
                            // Add event listeners to action buttons
                            row.querySelectorAll('button[data-action]').forEach(btn => {
                                btn.addEventListener('click', (e) => {
                                    const action = btn.getAttribute('data-action');
                                    const itemId = parseInt(btn.getAttribute('data-id'));
                                    
                                    if (action === 'edit') {
                                        this.showEditStockModal(itemId);
                                    } else if (action === 'delete') {
                                        this.showDeleteStockModal(itemId);
                                    }
                                });
                            });
                            
                            tableBody.appendChild(row);
                        });
                    }
                },
                
                prevPage() {
                    if (this.currentPage > 1) {
                        this.currentPage--;
                        this.renderItems();
                    }
                },
                
                nextPage() {
                    const totalPages = Math.ceil(this.filteredItems.length / this.itemsPerPage);
                    if (this.currentPage < totalPages) {
                        this.currentPage++;
                        this.renderItems();
                    }
                },
                
                showAddStockModal() {
                    const modalContent = `
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Item Name</label>
                                <input id="stock-name" type="text" class="w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Product name">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">SKU</label>
                                <input id="stock-sku" type="text" class="w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Stock keeping unit">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Category</label>
                                <select id="stock-category" class="w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <option value="">Select a category</option>
                                    <option value="electronics">Electronics</option>
                                    <option value="clothing">Clothing</option>
                                    <option value="furniture">Furniture</option>
                                    <option value="office">Office Supplies</option>
                                    <option value="food">Food & Beverage</option>
                                </select>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Quantity</label>
                                    <input id="stock-quantity" type="number" min="0" class="w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="0">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Price</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <span class="text-gray-500 dark:text-gray-400">$</span>
                                        </div>
                                        <input id="stock-price" type="number" min="0" step="0.01" class="w-full pl-7 pr-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="0.00">
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Supplier</label>
                                <input id="stock-supplier" type="text" class="w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Supplier name">
                            </div>
                        </div>
                    `;
                    
                    const buttons = [
                        {
                            text: 'Cancel',
                            class: 'px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-300',
                            onClick: () => util.closeModal()
                        },
                        {
                            text: 'Add Item',
                            class: 'px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors duration-300',
                            onClick: () => {
                                const name = document.getElementById('stock-name').value;
                                const sku = document.getElementById('stock-sku').value;
                                const category = document.getElementById('stock-category').value;
                                const quantity = parseInt(document.getElementById('stock-quantity').value);
                                const price = parseFloat(document.getElementById('stock-price').value);
                                const supplier = document.getElementById('stock-supplier').value;
                                
                                // Validation
                                if (!name || !sku || !category || isNaN(quantity) || isNaN(price)) {
                                    util.showToast('Please fill in all required fields', 'error');
                                    return;
                                }
                                
                                // Determine status based on quantity
                                let status = 'in_stock';
                                if (quantity <= 0) {
                                    status = 'out_of_stock';
                                } else if (quantity <= 10) {
                                    status = 'low_stock';
                                }
                                
                                // Add new stock item
                                const newItem = {
                                    id: Date.now(),
                                    name,
                                    sku,
                                    category,
                                    quantity,
                                    price,
                                    status,
                                    supplier,
                                    lastUpdated: new Date().toISOString().replace('T', ' ').split('.')[0]
                                };
                                
                                db.stockItems.push(newItem);
                                
                                // Add activity log
                                db.activityLog.unshift({
                                    id: db.activityLog.length + 1,
                                    userId: auth.currentUser.id,
                                    userName: auth.currentUser.name,
                                    actionType: 'add_stock',
                                    details: `Added new stock item: ${name}`,
                                    timestamp: new Date().toISOString().replace('T', ' ').split('.')[0]
                                });
                                
                                // Refresh stock management
                                this.loadItems();
                                
                                util.closeModal();
                                util.showToast('Stock item added successfully', 'success');
                            }
                        }
                    ];
                    
                    util.showModal('Add Stock Item', modalContent, buttons);
                },
                
                showEditStockModal(itemId) {
                    const item = this.items.find(i => i.id === itemId);
                    if (!item) return;
                    
                    const modalContent = `
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Item Name</label>
                                <input id="stock-name" type="text" class="w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Product name" value="${item.name}">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">SKU</label>
                                <input id="stock-sku" type="text" class="w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Stock keeping unit" value="${item.sku}">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Category</label>
                                <select id="stock-category" class="w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <option value="">Select a category</option>
                                    <option value="electronics" ${item.category === 'electronics' ? 'selected' : ''}>Electronics</option>
                                    <option value="clothing" ${item.category === 'clothing' ? 'selected' : ''}>Clothing</option>
                                    <option value="furniture" ${item.category === 'furniture' ? 'selected' : ''}>Furniture</option>
                                    <option value="office" ${item.category === 'office' ? 'selected' : ''}>Office Supplies</option>
                                    <option value="food" ${item.category === 'food' ? 'selected' : ''}>Food & Beverage</option>
                                </select>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Quantity</label>
                                    <input id="stock-quantity" type="number" min="0" class="w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="0" value="${item.quantity}">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Price</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <span class="text-gray-500 dark:text-gray-400">$</span>
                                        </div>
                                        <input id="stock-price" type="number" min="0" step="0.01" class="w-full pl-7 pr-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="0.00" value="${item.price}">
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Supplier</label>
                                <input id="stock-supplier" type="text" class="w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Supplier name" value="${item.supplier}">
                            </div>
                        </div>
                    `;
                    
                    const buttons = [
                        {
                            text: 'Cancel',
                            class: 'px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-300',
                            onClick: () => util.closeModal()
                        },
                        {
                            text: 'Save Changes',
                            class: 'px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors duration-300',
                            onClick: () => {
                                const name = document.getElementById('stock-name').value;
                                const sku = document.getElementById('stock-sku').value;
                                const category = document.getElementById('stock-category').value;
                                const quantity = parseInt(document.getElementById('stock-quantity').value);
                                const price = parseFloat(document.getElementById('stock-price').value);
                                const supplier = document.getElementById('stock-supplier').value;
                                
                                // Validation
                                if (!name || !sku || !category || isNaN(quantity) || isNaN(price)) {
                                    util.showToast('Please fill in all required fields', 'error');
                                    return;
                                }
                                
                                // Determine status based on quantity
                                let status = 'in_stock';
                                if (quantity <= 0) {
                                    status = 'out_of_stock';
                                } else if (quantity <= 10) {
                                    status = 'low_stock';
                                }
                                
                                // Update stock item
                                const index = db.stockItems.findIndex(i => i.id === itemId);
                                if (index !== -1) {
                                    db.stockItems[index] = {
                                        ...db.stockItems[index],
                                        name,
                                        sku,
                                        category,
                                        quantity,
                                        price,
                                        status,
                                        supplier,
                                        lastUpdated: new Date().toISOString().replace('T', ' ').split('.')[0]
                                    };
                                    
                                    // Add activity log
                                    db.activityLog.unshift({
                                        id: db.activityLog.length + 1,
                                        userId: auth.currentUser.id,
                                        userName: auth.currentUser.name,
                                        actionType: 'update_stock',
                                        details: `Updated stock item: ${name}`,
                                        timestamp: new Date().toISOString().replace('T', ' ').split('.')[0]
                                    });
                                    
                                    // Refresh stock management
                                    this.loadItems();
                                    
                                    util.closeModal();
                                    util.showToast('Stock item updated successfully', 'success');
                                }
                            }
                        }
                    ];
                    
                    util.showModal('Edit Stock Item', modalContent, buttons);
                },
                
                showDeleteStockModal(itemId) {
                    const item = this.items.find(i => i.id === itemId);
                    if (!item) return;
                    
                    const modalContent = `
                        <p class="text-gray-700 dark:text-gray-300 mb-4">Are you sure you want to delete <span class="font-medium">${item.name}</span>?</p>
                        <p class="text-gray-700 dark:text-gray-300">This action cannot be undone.</p>
                    `;
                    
                    const buttons = [
                        {
                            text: 'Cancel',
                            class: 'px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-300',
                            onClick: () => util.closeModal()
                        },
                        {
                            text: 'Delete',
                            class: 'px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors duration-300',
                            onClick: () => {
                                // Remove stock item
                                const index = db.stockItems.findIndex(i => i.id === itemId);
                                if (index !== -1) {
                                    const deletedItem = db.stockItems[index];
                                    db.stockItems.splice(index, 1);
                                    
                                    // Add activity log
                                    db.activityLog.unshift({
                                        id: db.activityLog.length + 1,
                                        userId: auth.currentUser.id,
                                        userName: auth.currentUser.name,
                                        actionType: 'delete_stock',
                                        details: `Deleted stock item: ${deletedItem.name}`,
                                        timestamp: new Date().toISOString().replace('T', ' ').split('.')[0]
                                    });
                                    
                                    // Refresh stock management
                                    this.loadItems();
                                    
                                    util.closeModal();
                                    util.showToast('Stock item deleted successfully', 'success');
                                }
                            }
                        }
                    ];
                    
                    util.showModal('Delete Stock Item', modalContent, buttons);
                }
            };
            
            // ORDER MANAGEMENT
            const orderManagement = {
                orders: [],
                filteredOrders: [],
                currentPage: 1,
                ordersPerPage: 10,
                
                init() {
                    this.loadOrders();
                },
                
                loadOrders() {
                    this.orders = [...db.orders];
                    this.filterOrders();
                },
                
                filterOrders() {
                    const searchTerm = document.getElementById('order-search').value.toLowerCase();
                    const statusFilter = document.getElementById('order-status-filter').value;
                    
                    this.filteredOrders = this.orders.filter(order => {
                        // Apply search filter
                        const matchesSearch = 
                            order.id.toLowerCase().includes(searchTerm) ||
                            order.customerName.toLowerCase().includes(searchTerm) ||
                            order.items.some(item => item.name.toLowerCase().includes(searchTerm));
                        
                        // Apply status filter
                        const matchesStatus = !statusFilter || order.status === statusFilter;
                        
                        return matchesSearch && matchesStatus;
                    });
                    
                    this.currentPage = 1;
                    this.renderOrders();
                },
                
                renderOrders() {
                    const tableBody = document.getElementById('orders-table-body');
                    const emptyMessage = document.getElementById('orders-table-empty');
                    
                    // Calculate pagination
                    const startIndex = (this.currentPage - 1) * this.ordersPerPage;
                    const endIndex = startIndex + this.ordersPerPage;
                    const paginatedOrders = this.filteredOrders.slice(startIndex, endIndex);
                    
                    // Update pagination info
                    document.getElementById('orders-showing-start').textContent = this.filteredOrders.length > 0 ? startIndex + 1 : 0;
                    document.getElementById('orders-showing-end').textContent = Math.min(endIndex, this.filteredOrders.length);
                    document.getElementById('orders-total').textContent = this.filteredOrders.length;
                    
                    // Enable/disable pagination buttons
                    document.getElementById('orders-prev-page').disabled = this.currentPage === 1;
                    document.getElementById('orders-prev-page').classList.toggle('opacity-50', this.currentPage === 1);
                    
                    document.getElementById('orders-next-page').disabled = endIndex >= this.filteredOrders.length;
                    document.getElementById('orders-next-page').classList.toggle('opacity-50', endIndex >= this.filteredOrders.length);
                    
                    // Clear table
                    tableBody.innerHTML = '';
                    
                    // Show empty message if no orders
                    if (paginatedOrders.length === 0) {
                        emptyMessage.classList.remove('hidden');
                    } else {
                        emptyMessage.classList.add('hidden');
                        
                        // Render orders
                        paginatedOrders.forEach(order => {
                            const row = document.createElement('tr');
                            row.className = 'border-b dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50';
                            
                            // Format date
                            const formattedDate = util.formatDate(order.date);
                            
                            // Determine status badge style
                            let statusBadge = '';
                            switch (order.status) {
                                case 'pending':
                                    statusBadge = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-500">
                                        <svg class="-ml-0.5 mr-1.5 h-2 w-2 text-blue-400" fill="currentColor" viewBox="0 0 8 8">
                                            <circle cx="4" cy="4" r="3" />
                                        </svg>
                                        Pending
                                    </span>`;
                                    break;
                                case 'processing':
                                    statusBadge = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-500">
                                        <svg class="-ml-0.5 mr-1.5 h-2 w-2 text-amber-400" fill="currentColor" viewBox="0 0 8 8">
                                            <circle cx="4" cy="4" r="3" />
                                        </svg>
                                        Processing
                                    </span>`;
                                    break;
                                case 'completed':
                                    statusBadge = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-500">
                                        <svg class="-ml-0.5 mr-1.5 h-2 w-2 text-green-400" fill="currentColor" viewBox="0 0 8 8">
                                            <circle cx="4" cy="4" r="3" />
                                        </svg>
                                        Completed
                                    </span>`;
                                    break;
                                case 'canceled':
                                    statusBadge = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-500">
                                        <svg class="-ml-0.5 mr-1.5 h-2 w-2 text-red-400" fill="currentColor" viewBox="0 0 8 8">
                                            <circle cx="4" cy="4" r="3" />
                                        </svg>
                                        Canceled
                                    </span>`;
                                    break;
                            }
                            
                            row.innerHTML = `
                                <td class="px-4 py-3 text-sm font-medium text-gray-900 dark:text-white">${order.id}</td>
                                <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">${order.customerName}</td>
                                <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">${order.items.length}</td>
                                <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">${formattedDate}</td>
                                <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">${util.formatCurrency(order.total)}</td>
                                <td class="px-4 py-3 text-sm">${statusBadge}</td>
                                <td class="px-4 py-3 text-sm">
                                    <div class="flex items-center space-x-2">
                                        <button class="text-primary-600 dark:text-primary-400 hover:text-primary-800 dark:hover:text-primary-300" data-action="view" data-id="${order.id}">
                                            <i class="ri-eye-line"></i>
                                        </button>
                                        <button class="text-primary-600 dark:text-primary-400 hover:text-primary-800 dark:hover:text-primary-300" data-action="edit" data-id="${order.id}">
                                            <i class="ri-edit-line"></i>
                                        </button>
                                        <button class="text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300" data-action="delete" data-id="${order.id}">
                                            <i class="ri-delete-bin-line"></i>
                                        </button>
                                    </div>
                                </td>
                            `;
                            
                            // Add event listeners to action buttons
                            row.querySelectorAll('button[data-action]').forEach(btn => {
                                btn.addEventListener('click', (e) => {
                                    const action = btn.getAttribute('data-action');
                                    const orderId = btn.getAttribute('data-id');
                                    
                                    if (action === 'view') {
                                        this.showViewOrderModal(orderId);
                                    } else if (action === 'edit') {
                                        this.showEditOrderModal(orderId);
                                    } else if (action === 'delete') {
                                        this.showDeleteOrderModal(orderId);
                                    }
                                });
                            });
                            
                            tableBody.appendChild(row);
                        });
                    }
                },
                
                prevPage() {
                    if (this.currentPage > 1) {
                        this.currentPage--;
                        this.renderOrders();
                    }
                },
                
                nextPage() {
                    const totalPages = Math.ceil(this.filteredOrders.length / this.ordersPerPage);
                    if (this.currentPage < totalPages) {
                        this.currentPage++;
                        this.renderOrders();
                    }
                },
                
                showAddOrderModal() {
                    let itemRowCount = 1;
                    
                    const renderItemRows = (count) => {
                        let rows = '';
                        for (let i = 0; i < count; i++) {
                            rows += `
                                <div class="order-item-row grid grid-cols-5 gap-2">
                                    <div class="col-span-2">
                                        <select class="order-item-select w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                            <option value="">Select Item</option>
                                            ${db.stockItems.map(item => `<option value="${item.id}" data-price="${item.price}">${item.name}</option>`).join('')}
                                        </select>
                                    </div>
                                    <div>
                                        <input type="number" min="1" value="1" class="order-item-quantity w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    </div>
                                    <div>
                                        <input type="text" readonly class="order-item-price w-full px-3 py-2 text-base border rounded-md bg-gray-100 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-300" placeholder="$0.00">
                                    </div>
                                    <div class="flex items-center">
                                        <button class="order-item-remove text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300">
                                            <i class="ri-delete-bin-line"></i>
                                        </button>
                                    </div>
                                </div>
                            `;
                        }
                        return rows;
                    };
                    
                    const modalContent = `
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Customer</label>
                                <select id="order-customer" class="w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <option value="">Select Customer</option>
                                    ${db.customers.map(customer => `<option value="${customer.id}">${customer.name}</option>`).join('')}
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Status</label>
                                <select id="order-status" class="w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <option value="pending">Pending</option>
                                    <option value="processing">Processing</option>
                                    <option value="completed">Completed</option>
                                    <option value="canceled">Canceled</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Payment Method</label>
                                <select id="order-payment" class="w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <option value="Credit Card">Credit Card</option>
                                    <option value="PayPal">PayPal</option>
                                    <option value="Bank Transfer">Bank Transfer</option>
                                    <option value="Cash">Cash</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Order Items</label>
                                <div id="order-items-container" class="space-y-2">
                                    <div class="grid grid-cols-5 gap-2 mb-2">
                                        <div class="col-span-2">
                                            <label class="block text-xs font-medium text-gray-500 dark:text-gray-400">Item</label>
                                        </div>
                                        <div>
                                            <label class="block text-xs font-medium text-gray-500 dark:text-gray-400">Qty</label>
                                        </div>
                                        <div>
                                            <label class="block text-xs font-medium text-gray-500 dark:text-gray-400">Price</label>
                                        </div>
                                        <div>
                                            <label class="block text-xs font-medium text-gray-500 dark:text-gray-400">Action</label>
                                        </div>
                                    </div>
                                    ${renderItemRows(itemRowCount)}
                                </div>
                                <div class="mt-2">
                                    <button id="add-item-row" class="text-sm text-primary-600 dark:text-primary-400 hover:text-primary-800 dark:hover:text-primary-300 flex items-center">
                                        <i class="ri-add-line mr-1"></i>
                                        <span>Add Item</span>
                                    </button>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Notes</label>
                                <textarea id="order-notes" class="w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" rows="2"></textarea>
                            </div>
                            
                            <div class="text-right">
                                <p class="text-xl font-semibold text-gray-900 dark:text-white">Total: <span id="order-total">$0.00</span></p>
                            </div>
                        </div>
                    `;
                    
                    const buttons = [
                        {
                            text: 'Cancel',
                            class: 'px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-300',
                            onClick: () => util.closeModal()
                        },
                        {
                            text: 'Create Order',
                            class: 'px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors duration-300',
                            onClick: () => {
                                const customerId = document.getElementById('order-customer').value;
                                const status = document.getElementById('order-status').value;
                                const paymentMethod = document.getElementById('order-payment').value;
                                const notes = document.getElementById('order-notes').value;
                                
                                // Validation
                                if (!customerId) {
                                    util.showToast('Please select a customer', 'error');
                                    return;
                                }
                                
                                // Get order items
                                const orderItems = [];
                                let total = 0;
                                
                                document.querySelectorAll('.order-item-row').forEach(row => {
                                    const itemSelect = row.querySelector('.order-item-select');
                                    const quantityInput = row.querySelector('.order-item-quantity');
                                    
                                    if (itemSelect.value) {
                                        const itemId = parseInt(itemSelect.value);
                                        const quantity = parseInt(quantityInput.value);
                                        const stockItem = db.stockItems.find(item => item.id === itemId);
                                        
                                        if (stockItem) {
                                            const price = parseFloat(stockItem.price);
                                            const subtotal = price * quantity;
                                            
                                            orderItems.push({
                                                id: itemId,
                                                name: stockItem.name,
                                                quantity: quantity,
                                                price: price,
                                                subtotal: subtotal
                                            });
                                            
                                            total += subtotal;
                                        }
                                    }
                                });
                                
                                if (orderItems.length === 0) {
                                    util.showToast('Please add at least one item to the order', 'error');
                                    return;
                                }
                                
                                // Create new order
                                const customer = db.customers.find(c => c.id === parseInt(customerId));
                                const newOrder = {
                                    id: `ORD${String(db.orders.length + 1).padStart(5, '0')}`,
                                    customerId: parseInt(customerId),
                                    customerName: customer.name,
                                    date: new Date().toISOString().replace('T', ' ').split('.')[0],
                                    items: orderItems,
                                    total: total,
                                    status: status,
                                    paymentMethod: paymentMethod,
                                    notes: notes
                                };
                                
                                db.orders.push(newOrder);
                                
                                // Add activity log
                                db.activityLog.unshift({
                                    id: db.activityLog.length + 1,
                                    userId: auth.currentUser.id,
                                    userName: auth.currentUser.name,
                                    actionType: 'add_order',
                                    details: `Created new order: ${newOrder.id}`,
                                    timestamp: new Date().toISOString().replace('T', ' ').split('.')[0]
                                });
                                
                                // Refresh order management
                                this.loadOrders();
                                
                                util.closeModal();
                                util.showToast('Order created successfully', 'success');
                            }
                        }
                    ];
                    
                    const modal = util.showModal('Create New Order', modalContent, buttons);
                    
                    // Add event listeners for items
                    const setupItemListeners = () => {
                        document.querySelectorAll('.order-item-select, .order-item-quantity').forEach(input => {
                            input.addEventListener('change', updateOrderTotal);
                        });
                        
                        document.querySelectorAll('.order-item-remove').forEach(btn => {
                            btn.addEventListener('click', (e) => {
                                const row = e.target.closest('.order-item-row');
                                if (document.querySelectorAll('.order-item-row').length > 1) {
                                    row.remove();
                                    updateOrderTotal();
                                } else {
                                    util.showToast('Order must have at least one item', 'error');
                                }
                            });
                        });
                    };
                    
                    // Add row button
                    modal.querySelector('#add-item-row').addEventListener('click', () => {
                        const container = modal.querySelector('#order-items-container');
                        const newRow = document.createElement('div');
                        newRow.innerHTML = renderItemRows(1);
                        container.appendChild(newRow.firstElementChild);
                        setupItemListeners();
                    });
                    
                    // Calculate order total
                    const updateOrderTotal = () => {
                        let total = 0;
                        
                        document.querySelectorAll('.order-item-row').forEach(row => {
                            const itemSelect = row.querySelector('.order-item-select');
                            const quantityInput = row.querySelector('.order-item-quantity');
                            const priceInput = row.querySelector('.order-item-price');
                            
                            if (itemSelect.value) {
                                const selectedOption = itemSelect.options[itemSelect.selectedIndex];
                                const price = parseFloat(selectedOption.getAttribute('data-price'));
                                const quantity = parseInt(quantityInput.value) || 0;
                                const subtotal = price * quantity;
                                
                                priceInput.value = util.formatCurrency(subtotal);
                                total += subtotal;
                            } else {
                                priceInput.value = '';
                            }
                        });
                        
                        document.getElementById('order-total').textContent = util.formatCurrency(total);
                    };
                    
                    // Setup initial listeners
                    setupItemListeners();
                },
                
                showViewOrderModal(orderId) {
                    const order = this.orders.find(o => o.id === orderId);
                    if (!order) return;
                    
                    const formattedDate = util.formatDate(order.date);
                    
                    // Create items table
                    let itemsHtml = '';
                    order.items.forEach(item => {
                        itemsHtml += `
                            <tr class="border-b dark:border-gray-700">
                                <td class="px-3 py-2 text-sm text-gray-900 dark:text-white">${item.name}</td>
                                <td class="px-3 py-2 text-sm text-gray-900 dark:text-white text-center">${item.quantity}</td>
                                <td class="px-3 py-2 text-sm text-gray-900 dark:text-white text-right">${util.formatCurrency(item.price)}</td>
                                <td class="px-3 py-2 text-sm text-gray-900 dark:text-white text-right">${util.formatCurrency(item.subtotal)}</td>
                            </tr>
                        `;
                    });
                    
                    // Determine status badge style
                    let statusBadge = '';
                    switch (order.status) {
                        case 'pending':
                            statusBadge = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-500">
                                <svg class="-ml-0.5 mr-1.5 h-2 w-2 text-blue-400" fill="currentColor" viewBox="0 0 8 8">
                                    <circle cx="4" cy="4" r="3" />
                                </svg>
                                Pending
                            </span>`;
                            break;
                        case 'processing':
                            statusBadge = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-500">
                                <svg class="-ml-0.5 mr-1.5 h-2 w-2 text-amber-400" fill="currentColor" viewBox="0 0 8 8">
                                    <circle cx="4" cy="4" r="3" />
                                </svg>
                                Processing
                            </span>`;
                            break;
                        case 'completed':
                            statusBadge = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-500">
                                <svg class="-ml-0.5 mr-1.5 h-2 w-2 text-green-400" fill="currentColor" viewBox="0 0 8 8">
                                    <circle cx="4" cy="4" r="3" />
                                </svg>
                                Completed
                            </span>`;
                            break;
                        case 'canceled':
                            statusBadge = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-500">
                                <svg class="-ml-0.5 mr-1.5 h-2 w-2 text-red-400" fill="currentColor" viewBox="0 0 8 8">
                                    <circle cx="4" cy="4" r="3" />
                                </svg>
                                Canceled
                            </span>`;
                            break;
                    }
                    
                    const modalContent = `
                        <div class="space-y-4">
                            <div class="flex flex-col sm:flex-row justify-between items-start gap-3">
                                <div>
                                    <h4 class="text-xl font-bold text-gray-900 dark:text-white mb-1">${order.id}</h4>
                                    <p class="text-gray-600 dark:text-gray-400">${formattedDate}</p>
                                </div>
                                <div>
                                    ${statusBadge}
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <h5 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Customer</h5>
                                    <p class="text-gray-900 dark:text-white">${order.customerName}</p>
                                </div>
                                <div>
                                    <h5 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Payment Method</h5>
                                    <p class="text-gray-900 dark:text-white">${order.paymentMethod}</p>
                                </div>
                            </div>
                            
                            <div>
                                <h5 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-2">Order Items</h5>
                                <div class="border dark:border-gray-700 rounded-md overflow-hidden">
                                    <table class="min-w-full">
                                        <thead>
                                            <tr class="bg-gray-50 dark:bg-gray-700 border-b dark:border-gray-600">
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Item</th>
                                                <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Qty</th>
                                                <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Price</th>
                                                <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Subtotal</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${itemsHtml}
                                        </tbody>
                                        <tfoot class="bg-gray-50 dark:bg-gray-700">
                                            <tr>
                                                <td colspan="3" class="px-3 py-2 text-right text-sm font-medium text-gray-700 dark:text-gray-300">Total:</td>
                                                <td class="px-3 py-2 text-right text-sm font-medium text-gray-900 dark:text-white">${util.formatCurrency(order.total)}</td>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                            
                            ${order.notes ? `
                                <div>
                                    <h5 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Notes</h5>
                                    <p class="text-gray-700 dark:text-gray-300">${order.notes}</p>
                                </div>
                            ` : ''}
                            
                            <div class="pt-2 flex gap-3">
                                <button id="view-edit-btn" class="px-4 py-2 text-sm border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-300">
                                    <i class="ri-edit-line mr-1"></i>
                                    Edit Order
                                </button>
                                <button id="view-invoice-btn" class="px-4 py-2 text-sm bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors duration-300">
                                    <i class="ri-file-list-3-line mr-1"></i>
                                    Generate Invoice
                                </button>
                            </div>
                        </div>
                    `;
                    
                    const buttons = [];
                    
                    const modal = util.showModal('Order Details', modalContent, buttons);
                    
                    // Add button event listeners
                    modal.querySelector('#view-edit-btn').addEventListener('click', () => {
                        util.closeModal();
                        this.showEditOrderModal(orderId);
                    });
                    
                    modal.querySelector('#view-invoice-btn').addEventListener('click', () => {
                        // In a real app, this would generate an invoice
                        util.showToast('Generating invoice...', 'info');
                        
                        setTimeout(() => {
                            util.showToast('Invoice generated successfully! Right-click and use Save As to download', 'success');
                        }, 1500);
                    });
                },
                
                showEditOrderModal(orderId) {
                    const order = this.orders.find(o => o.id === orderId);
                    if (!order) return;
                    
                    // Render item rows for existing order items
                    const renderItemRows = () => {
                        let rows = '';
                        order.items.forEach(item => {
                            rows += `
                                <div class="order-item-row grid grid-cols-5 gap-2">
                                    <div class="col-span-2">
                                        <select class="order-item-select w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                            <option value="">Select Item</option>
                                            ${db.stockItems.map(stockItem => `<option value="${stockItem.id}" data-price="${stockItem.price}" ${stockItem.id === item.id ? 'selected' : ''}>${stockItem.name}</option>`).join('')}
                                        </select>
                                    </div>
                                    <div>
                                        <input type="number" min="1" value="${item.quantity}" class="order-item-quantity w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    </div>
                                    <div>
                                        <input type="text" readonly class="order-item-price w-full px-3 py-2 text-base border rounded-md bg-gray-100 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-300" value="${util.formatCurrency(item.subtotal)}">
                                    </div>
                                    <div class="flex items-center">
                                        <button class="order-item-remove text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300">
                                            <i class="ri-delete-bin-line"></i>
                                        </button>
                                    </div>
                                </div>
                            `;
                        });
                        return rows;
                    };
                    
                    const modalContent = `
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Order ID</label>
                                <input type="text" value="${order.id}" class="w-full px-3 py-2 text-base border rounded-md bg-gray-100 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-300" readonly>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Customer</label>
                                <select id="order-customer" class="w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <option value="">Select Customer</option>
                                    ${db.customers.map(customer => `<option value="${customer.id}" ${customer.id === order.customerId ? 'selected' : ''}>${customer.name}</option>`).join('')}
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Status</label>
                                <select id="order-status" class="w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>Pending</option>
                                    <option value="processing" ${order.status === 'processing' ? 'selected' : ''}>Processing</option>
                                    <option value="completed" ${order.status === 'completed' ? 'selected' : ''}>Completed</option>
                                    <option value="canceled" ${order.status === 'canceled' ? 'selected' : ''}>Canceled</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Payment Method</label>
                                <select id="order-payment" class="w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <option value="Credit Card" ${order.paymentMethod === 'Credit Card' ? 'selected' : ''}>Credit Card</option>
                                    <option value="PayPal" ${order.paymentMethod === 'PayPal' ? 'selected' : ''}>PayPal</option>
                                    <option value="Bank Transfer" ${order.paymentMethod === 'Bank Transfer' ? 'selected' : ''}>Bank Transfer</option>
                                    <option value="Cash" ${order.paymentMethod === 'Cash' ? 'selected' : ''}>Cash</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Order Items</label>
                                <div id="order-items-container" class="space-y-2">
                                    <div class="grid grid-cols-5 gap-2 mb-2">
                                        <div class="col-span-2">
                                            <label class="block text-xs font-medium text-gray-500 dark:text-gray-400">Item</label>
                                        </div>
                                        <div>
                                            <label class="block text-xs font-medium text-gray-500 dark:text-gray-400">Qty</label>
                                        </div>
                                        <div>
                                            <label class="block text-xs font-medium text-gray-500 dark:text-gray-400">Price</label>
                                        </div>
                                        <div>
                                            <label class="block text-xs font-medium text-gray-500 dark:text-gray-400">Action</label>
                                        </div>
                                    </div>
                                    ${renderItemRows()}
                                </div>
                                <div class="mt-2">
                                    <button id="add-item-row" class="text-sm text-primary-600 dark:text-primary-400 hover:text-primary-800 dark:hover:text-primary-300 flex items-center">
                                        <i class="ri-add-line mr-1"></i>
                                        <span>Add Item</span>
                                    </button>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Notes</label>
                                <textarea id="order-notes" class="w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" rows="2">${order.notes || ''}</textarea>
                            </div>
                            
                            <div class="text-right">
                                <p class="text-xl font-semibold text-gray-900 dark:text-white">Total: <span id="order-total">${util.formatCurrency(order.total)}</span></p>
                            </div>
                        </div>
                    `;
                    
                    const buttons = [
                        {
                            text: 'Cancel',
                            class: 'px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-300',
                            onClick: () => util.closeModal()
                        },
                        {
                            text: 'Save Changes',
                            class: 'px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors duration-300',
                            onClick: () => {
                                const customerId = document.getElementById('order-customer').value;
                                const status = document.getElementById('order-status').value;
                                const paymentMethod = document.getElementById('order-payment').value;
                                const notes = document.getElementById('order-notes').value;
                                
                                // Validation
                                if (!customerId) {
                                    util.showToast('Please select a customer', 'error');
                                    return;
                                }
                                
                                // Get order items
                                const orderItems = [];
                                let total = 0;
                                
                                document.querySelectorAll('.order-item-row').forEach(row => {
                                    const itemSelect = row.querySelector('.order-item-select');
                                    const quantityInput = row.querySelector('.order-item-quantity');
                                    
                                    if (itemSelect.value) {
                                        const itemId = parseInt(itemSelect.value);
                                        const quantity = parseInt(quantityInput.value);
                                        const stockItem = db.stockItems.find(item => item.id === itemId);
                                        
                                        if (stockItem) {
                                            const price = parseFloat(stockItem.price);
                                            const subtotal = price * quantity;
                                            
                                            orderItems.push({
                                                id: itemId,
                                                name: stockItem.name,
                                                quantity: quantity,
                                                price: price,
                                                subtotal: subtotal
                                            });
                                            
                                            total += subtotal;
                                        }
                                    }
                                });
                                
                                if (orderItems.length === 0) {
                                    util.showToast('Please add at least one item to the order', 'error');
                                    return;
                                }
                                
                                // Update order
                                const index = db.orders.findIndex(o => o.id === orderId);
                                if (index !== -1) {
                                    const customer = db.customers.find(c => c.id === parseInt(customerId));
                                    
                                    db.orders[index] = {
                                        ...db.orders[index],
                                        customerId: parseInt(customerId),
                                        customerName: customer.name,
                                        items: orderItems,
                                        total: total,
                                        status: status,
                                        paymentMethod: paymentMethod,
                                        notes: notes
                                    };
                                    
                                    // Add activity log
                                    db.activityLog.unshift({
                                        id: db.activityLog.length + 1,
                                        userId: auth.currentUser.id,
                                        userName: auth.currentUser.name,
                                        actionType: 'update_order',
                                        details: `Updated order status to ${status}: ${orderId}`,
                                        timestamp: new Date().toISOString().replace('T', ' ').split('.')[0]
                                    });
                                    
                                    // Refresh order management
                                    this.loadOrders();
                                    
                                    util.closeModal();
                                    util.showToast('Order updated successfully', 'success');
                                }
                            }
                        }
                    ];
                    
                    const modal = util.showModal('Edit Order', modalContent, buttons);
                    
                    // Add event listeners for items
                    const setupItemListeners = () => {
                        document.querySelectorAll('.order-item-select, .order-item-quantity').forEach(input => {
                            input.addEventListener('change', updateOrderTotal);
                        });
                        
                        document.querySelectorAll('.order-item-remove').forEach(btn => {
                            btn.addEventListener('click', (e) => {
                                const row = e.target.closest('.order-item-row');
                                if (document.querySelectorAll('.order-item-row').length > 1) {
                                    row.remove();
                                    updateOrderTotal();
                                } else {
                                    util.showToast('Order must have at least one item', 'error');
                                }
                            });
                        });
                    };
                    
                    // Add row button
                    modal.querySelector('#add-item-row').addEventListener('click', () => {
                        const container = modal.querySelector('#order-items-container');
                        const newRow = document.createElement('div');
                        newRow.innerHTML = `
                            <div class="order-item-row grid grid-cols-5 gap-2">
                                <div class="col-span-2">
                                    <select class="order-item-select w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                        <option value="">Select Item</option>
                                        ${db.stockItems.map(stockItem => `<option value="${stockItem.id}" data-price="${stockItem.price}">${stockItem.name}</option>`).join('')}
                                    </select>
                                </div>
                                <div>
                                    <input type="number" min="1" value="1" class="order-item-quantity w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                </div>
                                <div>
                                    <input type="text" readonly class="order-item-price w-full px-3 py-2 text-base border rounded-md bg-gray-100 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-300" placeholder="$0.00">
                                </div>
                                <div class="flex items-center">
                                    <button class="order-item-remove text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300">
                                        <i class="ri-delete-bin-line"></i>
                                    </button>
                                </div>
                            </div>
                        `;
                        container.appendChild(newRow.firstElementChild);
                        setupItemListeners();
                    });
                    
                    // Calculate order total
                    const updateOrderTotal = () => {
                        let total = 0;
                        
                        document.querySelectorAll('.order-item-row').forEach(row => {
                            const itemSelect = row.querySelector('.order-item-select');
                            const quantityInput = row.querySelector('.order-item-quantity');
                            const priceInput = row.querySelector('.order-item-price');
                            
                            if (itemSelect.value) {
                                const selectedOption = itemSelect.options[itemSelect.selectedIndex];
                                const price = parseFloat(selectedOption.getAttribute('data-price'));
                                const quantity = parseInt(quantityInput.value) || 0;
                                const subtotal = price * quantity;
                                
                                priceInput.value = util.formatCurrency(subtotal);
                                total += subtotal;
                            } else {
                                priceInput.value = '';
                            }
                        });
                        
                        document.getElementById('order-total').textContent = util.formatCurrency(total);
                    };
                    
                    // Setup initial listeners
                    setupItemListeners();
                },
                
                showDeleteOrderModal(orderId) {
                    const order = this.orders.find(o => o.id === orderId);
                    if (!order) return;
                    
                    const modalContent = `
                        <p class="text-gray-700 dark:text-gray-300 mb-4">Are you sure you want to delete order <span class="font-medium">${order.id}</span>?</p>
                        <p class="text-gray-700 dark:text-gray-300">This action cannot be undone.</p>
                    `;
                    
                    const buttons = [
                        {
                            text: 'Cancel',
                            class: 'px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-300',
                            onClick: () => util.closeModal()
                        },
                        {
                            text: 'Delete',
                            class: 'px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors duration-300',
                            onClick: () => {
                                // Remove order
                                const index = db.orders.findIndex(o => o.id === orderId);
                                if (index !== -1) {
                                    const deletedOrder = db.orders[index];
                                    db.orders.splice(index, 1);
                                    
                                    // Add activity log
                                    db.activityLog.unshift({
                                        id: db.activityLog.length + 1,
                                        userId: auth.currentUser.id,
                                        userName: auth.currentUser.name,
                                        actionType: 'delete_order',
                                        details: `Deleted order: ${deletedOrder.id}`,
                                        timestamp: new Date().toISOString().replace('T', ' ').split('.')[0]
                                    });
                                    
                                    // Refresh order management
                                    this.loadOrders();
                                    
                                    util.closeModal();
                                    util.showToast('Order deleted successfully', 'success');
                                }
                            }
                        }
                    ];
                    
                    util.showModal('Delete Order', modalContent, buttons);
                }
            };
            
            // REPORTS MANAGEMENT
            const reportsManagement = {
                currentReport: null,
                
                init() {
                    // Set default dates for custom range
                    const today = new Date();
                    const oneMonthAgo = new Date();
                    oneMonthAgo.setMonth(today.getMonth() - 1);
                    
                    document.getElementById('report-start-date').valueAsDate = oneMonthAgo;
                    document.getElementById('report-end-date').valueAsDate = today;
                },
                
                generateReport() {
                    const reportType = document.getElementById('report-type').value;
                    const dateRange = document.getElementById('report-date-range').value;
                    
                    // Show loading state
                    document.getElementById('report-loading').classList.remove('hidden');
                    document.getElementById('report-placeholder').classList.add('hidden');
                    document.getElementById('report-results').classList.add('hidden');
                    
                    // Calculate date range
                    let startDate, endDate;
                    const today = new Date();
                    
                    switch (dateRange) {
                        case 'today':
                            startDate = new Date(today.setHours(0, 0, 0, 0));
                            endDate = new Date();
                            break;
                        case 'yesterday':
                            startDate = new Date(today);
                            startDate.setDate(startDate.getDate() - 1);
                            startDate.setHours(0, 0, 0, 0);
                            endDate = new Date(startDate);
                            endDate.setHours(23, 59, 59, 999);
                            break;
                        case 'week':
                            startDate = new Date(today);
                            startDate.setDate(startDate.getDate() - 7);
                            endDate = new Date();
                            break;
                        case 'month':
                            startDate = new Date(today);
                            startDate.setMonth(startDate.getMonth() - 1);
                            endDate = new Date();
                            break;
                        case 'quarter':
                            startDate = new Date(today);
                            startDate.setMonth(startDate.getMonth() - 3);
                            endDate = new Date();
                            break;
                        case 'year':
                            startDate = new Date(today);
                            startDate.setFullYear(startDate.getFullYear() - 1);
                            endDate = new Date();
                            break;
                        case 'custom':
                            startDate = new Date(document.getElementById('report-start-date').value);
                            endDate = new Date(document.getElementById('report-end-date').value);
                            endDate.setHours(23, 59, 59, 999);
                            break;
                        default:
                            startDate = new Date(today);
                            startDate.setMonth(startDate.getMonth() - 1);
                            endDate = new Date();
                    }
                    
                    // Simulate report generation (in a real app, this would query a database)
                    setTimeout(() => {
                        switch (reportType) {
                            case 'sales':
                                this.generateSalesReport(startDate, endDate);
                                break;
                            case 'stock':
                                this.generateStockReport(startDate, endDate);
                                break;
                            case 'user':
                                this.generateUserReport(startDate, endDate);
                                break;
                            default:
                                this.generateSalesReport(startDate, endDate);
                        }
                        
                        // Hide loading state and show results
                        document.getElementById('report-loading').classList.add('hidden');
                        document.getElementById('report-placeholder').classList.add('hidden');
                        document.getElementById('report-results').classList.remove('hidden');
                    }, 1500);
                },
                
                generateSalesReport(startDate, endDate) {
                    // Filter orders by date range
                    const ordersInRange = db.orders.filter(order => {
                        const orderDate = new Date(order.date);
                        return orderDate >= startDate && orderDate <= endDate;
                    });
                    
                    // Calculate total sales and other metrics
                    const totalSales = ordersInRange.reduce((sum, order) => sum + order.total, 0);
                    const totalOrders = ordersInRange.length;
                    const completedOrders = ordersInRange.filter(order => order.status === 'completed').length;
                    const pendingOrders = ordersInRange.filter(order => order.status === 'pending').length;
                    const averageOrderValue = totalOrders > 0 ? totalSales / totalOrders : 0;
                    
                    // Generate data for chart
                    // Group by day for reasonable chart size
                    const salesByDay = {};
                    ordersInRange.forEach(order => {
                        const orderDate = new Date(order.date);
                        const dateKey = orderDate.toISOString().split('T')[0];
                        
                        if (!salesByDay[dateKey]) {
                            salesByDay[dateKey] = 0;
                        }
                        
                        salesByDay[dateKey] += order.total;
                    });
                    
                    const dateLabels = Object.keys(salesByDay).sort();
                    const salesData = dateLabels.map(date => salesByDay[date]);
                    
                    // Setup chart
                    this.setupReportChart(dateLabels, salesData, 'Sales Over Time', 'Amount ($)');
                    
                    // Setup summary cards
                    const summaryContainer = document.getElementById('report-summary');
                    summaryContainer.innerHTML = `
                        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                            <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-2">Total Sales</h4>
                            <p class="text-2xl font-bold text-gray-900 dark:text-white">${util.formatCurrency(totalSales)}</p>
                        </div>
                        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                            <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-2">Total Orders</h4>
                            <p class="text-2xl font-bold text-gray-900 dark:text-white">${totalOrders}</p>
                            <div class="mt-2 flex flex-col text-xs">
                                <span class="text-green-600 dark:text-green-400">${completedOrders} completed</span>
                                <span class="text-blue-600 dark:text-blue-400">${pendingOrders} pending</span>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                            <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-2">Average Order Value</h4>
                            <p class="text-2xl font-bold text-gray-900 dark:text-white">${util.formatCurrency(averageOrderValue)}</p>
                        </div>
                    `;
                    
                    // Setup table
                    const tableHead = document.getElementById('report-table-head');
                    tableHead.innerHTML = `
                        <tr class="bg-gray-50 dark:bg-gray-700 border-b dark:border-gray-600">
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Order ID</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Date</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Customer</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Items</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Total</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Status</th>
                        </tr>
                    `;
                    
                    const tableBody = document.getElementById('report-table-body');
                    tableBody.innerHTML = '';
                    
                    // Sort orders by date (newest first)
                    ordersInRange.sort((a, b) => new Date(b.date) - new Date(a.date));
                    
                    ordersInRange.forEach(order => {
                        const row = document.createElement('tr');
                        row.className = 'border-b dark:border-gray-700';
                        
                        // Determine status badge style
                        let statusBadge = '';
                        switch (order.status) {
                            case 'pending':
                                statusBadge = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-500">Pending</span>`;
                                break;
                            case 'processing':
                                statusBadge = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-500">Processing</span>`;
                                break;
                            case 'completed':
                                statusBadge = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-500">Completed</span>`;
                                break;
                            case 'canceled':
                                statusBadge = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-500">Canceled</span>`;
                                break;
                        }
                        
                        row.innerHTML = `
                            <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">${order.id}</td>
                            <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">${util.formatDate(order.date)}</td>
                            <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">${order.customerName}</td>
                            <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">${order.items.length}</td>
                            <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">${util.formatCurrency(order.total)}</td>
                            <td class="px-4 py-3 text-sm">${statusBadge}</td>
                        `;
                        
                        tableBody.appendChild(row);
                    });
                    
                    this.currentReport = {
                        type: 'sales',
                        startDate,
                        endDate,
                        data: {
                            totalSales,
                            totalOrders,
                            completedOrders,
                            pendingOrders,
                            averageOrderValue,
                            salesByDay
                        }
                    };
                },
                
                generateStockReport(startDate, endDate) {
                    // For a stock movement report, we would typically track inventory changes over time
                    // Since our mock data doesn't include historical stock levels, we'll create some simulated data
                    
                    // Calculate inventory metrics
                    const totalItems = db.stockItems.length;
                    const inStockItems = db.stockItems.filter(item => item.status === 'in_stock').length;
                    const lowStockItems = db.stockItems.filter(item => item.status === 'low_stock').length;
                    const outOfStockItems = db.stockItems.filter(item => item.status === 'out_of_stock').length;
                    
                    // Calculate total inventory value
                    const totalValue = db.stockItems.reduce((sum, item) => {
                        return sum + (item.quantity * parseFloat(item.price));
                    }, 0);
                    
                    // Generate data for chart - stock by category
                    const stockByCategory = {};
                    db.stockItems.forEach(item => {
                        if (!stockByCategory[item.category]) {
                            stockByCategory[item.category] = 0;
                        }
                        stockByCategory[item.category] += item.quantity;
                    });
                    
                    const categoryLabels = Object.keys(stockByCategory).map(cat => util.capitalize(cat));
                    const stockData = Object.values(stockByCategory);
                    
                    // Setup chart
                    this.setupReportChart(categoryLabels, stockData, 'Stock by Category', 'Quantity');
                    
                    // Setup summary cards
                    const summaryContainer = document.getElementById('report-summary');
                    summaryContainer.innerHTML = `
                        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                            <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-2">Total Inventory Value</h4>
                            <p class="text-2xl font-bold text-gray-900 dark:text-white">${util.formatCurrency(totalValue)}</p>
                        </div>
                        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                            <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-2">Total Stock Items</h4>
                            <p class="text-2xl font-bold text-gray-900 dark:text-white">${totalItems}</p>
                            <div class="mt-2 flex flex-col text-xs">
                                <span class="text-green-600 dark:text-green-400">${inStockItems} in stock</span>
                                <span class="text-amber-600 dark:text-amber-400">${lowStockItems} low stock</span>
                                <span class="text-red-600 dark:text-red-400">${outOfStockItems} out of stock</span>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                            <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-2">Inventory Health</h4>
                            <p class="text-2xl font-bold text-gray-900 dark:text-white">${Math.round((inStockItems / totalItems) * 100)}%</p>
                            <div class="mt-1 w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
                                <div class="bg-primary-600 h-2.5 rounded-full" style="width: ${(inStockItems / totalItems) * 100}%"></div>
                            </div>
                        </div>
                    `;
                    
                    // Setup table
                    const tableHead = document.getElementById('report-table-head');
                    tableHead.innerHTML = `
                        <tr class="bg-gray-50 dark:bg-gray-700 border-b dark:border-gray-600">
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Item</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">SKU</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Category</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">In Stock</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Price</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Total Value</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Status</th>
                        </tr>
                    `;
                    
                    const tableBody = document.getElementById('report-table-body');
                    tableBody.innerHTML = '';
                    
                    // Sort items by value (highest first)
                    const sortedItems = [...db.stockItems].sort((a, b) => {
                        const aValue = a.quantity * parseFloat(a.price);
                        const bValue = b.quantity * parseFloat(b.price);
                        return bValue - aValue;
                    });
                    
                    sortedItems.forEach(item => {
                        const row = document.createElement('tr');
                        row.className = 'border-b dark:border-gray-700';
                        
                        const itemValue = item.quantity * parseFloat(item.price);
                        
                        // Determine status badge style
                        let statusBadge = '';
                        switch (item.status) {
                            case 'in_stock':
                                statusBadge = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-500">In Stock</span>`;
                                break;
                            case 'low_stock':
                                statusBadge = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-500">Low Stock</span>`;
                                break;
                            case 'out_of_stock':
                                statusBadge = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-500">Out of Stock</span>`;
                                break;
                        }
                        
                        row.innerHTML = `
                            <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">${item.name}</td>
                            <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">${item.sku}</td>
                            <td class="px-4 py-3 text-sm text-gray-900 dark:text-white capitalize">${item.category}</td>
                            <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">${item.quantity}</td>
                            <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">${util.formatCurrency(item.price)}</td>
                            <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">${util.formatCurrency(itemValue)}</td>
                            <td class="px-4 py-3 text-sm">${statusBadge}</td>
                        `;
                        
                        tableBody.appendChild(row);
                    });
                    
                    this.currentReport = {
                        type: 'stock',
                        startDate,
                        endDate,
                        data: {
                            totalItems,
                            inStockItems,
                            lowStockItems,
                            outOfStockItems,
                            totalValue,
                            stockByCategory
                        }
                    };
                },
                
                generateUserReport(startDate, endDate) {
                    // Filter activities by date range
                    const activitiesInRange = db.activityLog.filter(activity => {
                        const activityDate = new Date(activity.timestamp);
                        return activityDate >= startDate && activityDate <= endDate;
                    });
                    
                    // Calculate user metrics
                    const totalActivities = activitiesInRange.length;
                    
                    // Count activities by type
                    const activitiesByType = {};
                    activitiesInRange.forEach(activity => {
                        if (!activitiesByType[activity.actionType]) {
                            activitiesByType[activity.actionType] = 0;
                        }
                        activitiesByType[activity.actionType]++;
                    });
                    
                    // Count activities by user
                    const activitiesByUser = {};
                    activitiesInRange.forEach(activity => {
                        if (!activitiesByUser[activity.userName]) {
                            activitiesByUser[activity.userName] = 0;
                        }
                        activitiesByUser[activity.userName]++;
                    });
                    
                    // Generate data for chart - activities by type
                    const actionTypeLabels = Object.keys(activitiesByType).map(type => {
                        return util.capitalize(type.replace('_', ' '));
                    });
                    const actionTypeData = Object.values(activitiesByType);
                    
                    // Setup chart
                    this.setupReportChart(actionTypeLabels, actionTypeData, 'Activities by Type', 'Count');
                    
                    // Calculate the most active user
                    let mostActiveUser = '';
                    let mostActivities = 0;
                    Object.entries(activitiesByUser).forEach(([user, count]) => {
                        if (count > mostActivities) {
                            mostActiveUser = user;
                            mostActivities = count;
                        }
                    });
                    
                    // Setup summary cards
                    const summaryContainer = document.getElementById('report-summary');
                    summaryContainer.innerHTML = `
                        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                            <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-2">Total Activities</h4>
                            <p class="text-2xl font-bold text-gray-900 dark:text-white">${totalActivities}</p>
                        </div>
                        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                            <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-2">Most Active User</h4>
                            <p class="text-2xl font-bold text-gray-900 dark:text-white">${mostActiveUser}</p>
                            <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">${mostActivities} activities</p>
                        </div>
                        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                            <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-2">Most Common Activity</h4>
                            <p class="text-2xl font-bold text-gray-900 dark:text-white">${actionTypeLabels[0]}</p>
                            <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">${actionTypeData[0]} occurrences</p>
                        </div>
                    `;
                    
                    // Setup table
                    const tableHead = document.getElementById('report-table-head');
                    tableHead.innerHTML = `
                        <tr class="bg-gray-50 dark:bg-gray-700 border-b dark:border-gray-600">
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">User</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Action</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Details</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Timestamp</th>
                        </tr>
                    `;
                    
                    const tableBody = document.getElementById('report-table-body');
                    tableBody.innerHTML = '';
                    
                    // Sort activities by date (newest first)
                    activitiesInRange.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                    
                    activitiesInRange.forEach(activity => {
                        const row = document.createElement('tr');
                        row.className = 'border-b dark:border-gray-700';
                        
                        const formattedDate = util.formatDate(activity.timestamp);
                        const formattedTime = util.formatTime(activity.timestamp);
                        
                        row.innerHTML = `
                            <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">${activity.userName}</td>
                            <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">${util.capitalize(activity.actionType.replace('_', ' '))}</td>
                            <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">${activity.details}</td>
                            <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">${formattedDate} ${formattedTime}</td>
                        `;
                        
                        tableBody.appendChild(row);
                    });
                    
                    this.currentReport = {
                        type: 'user',
                        startDate,
                        endDate,
                        data: {
                            totalActivities,
                            activitiesByType,
                            activitiesByUser,
                            mostActiveUser,
                            mostActivities
                        }
                    };
                },
                
                setupReportChart(labels, data, title, yAxisLabel) {
                    const chartContainer = document.getElementById('report-chart');
                    
                    // Check if chart already exists, destroy it
                    if (window.reportChart) {
                        window.reportChart.destroy();
                    }
                    
                    // Determine chart type based on data
                    let chartType = 'bar';
                    if (labels.length > 10) {
                        chartType = 'line';
                    }
                    
                    // Create the chart
                    window.reportChart = new Chart(chartContainer, {
                        type: chartType,
                        data: {
                            labels: labels,
                            datasets: [
                                {
                                    label: title,
                                    data: data,
                                    backgroundColor: 'rgba(139, 92, 246, 0.5)',
                                    borderColor: '#8b5cf6',
                                    borderWidth: 2,
                                    fill: chartType === 'line',
                                    tension: 0.3
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    labels: {
                                        color: document.documentElement.classList.contains('dark') ? '#e2e8f0' : '#334155'
                                    }
                                },
                                title: {
                                    display: true,
                                    text: title,
                                    color: document.documentElement.classList.contains('dark') ? '#e2e8f0' : '#334155'
                                }
                            },
                            scales: {
                                x: {
                                    grid: {
                                        display: false,
                                        color: document.documentElement.classList.contains('dark') ? '#475569' : '#e2e8f0'
                                    },
                                    ticks: {
                                        color: document.documentElement.classList.contains('dark') ? '#94a3b8' : '#64748b'
                                    }
                                },
                                y: {
                                    grid: {
                                        color: document.documentElement.classList.contains('dark') ? '#334155' : '#e2e8f0'
                                    },
                                    ticks: {
                                        color: document.documentElement.classList.contains('dark') ? '#94a3b8' : '#64748b'
                                    },
                                    title: {
                                        display: true,
                                        text: yAxisLabel,
                                        color: document.documentElement.classList.contains('dark') ? '#e2e8f0' : '#334155'
                                    }
                                }
                            }
                        }
                    });
                }
            };
            
            // USER MANAGEMENT
            const userManagement = {
                users: [],
                filteredUsers: [],
                
                init() {
                    this.loadUsers();
                },
                
                loadUsers() {
                    // Show/hide user management based on role
                    if (!auth.isAdmin()) {
                        // This shouldn't normally happen since we hide the UI, but just in case
                        ui.navigateTo('dashboard');
                        util.showToast('You do not have permission to access user management', 'error');
                        return;
                    }
                    
                    this.users = [...db.users];
                    this.filterUsers();
                },
                
                filterUsers() {
                    const searchTerm = document.getElementById('user-search').value.toLowerCase();
                    const roleFilter = document.getElementById('user-role-filter').value;
                    
                    this.filteredUsers = this.users.filter(user => {
                        // Apply search filter
                        const matchesSearch = 
                            user.name.toLowerCase().includes(searchTerm) ||
                            user.email.toLowerCase().includes(searchTerm);
                        
                        // Apply role filter
                        const matchesRole = !roleFilter || user.role === roleFilter;
                        
                        return matchesSearch && matchesRole;
                    });
                    
                    this.renderUsers();
                },
                
                renderUsers() {
                    const tableBody = document.getElementById('users-table-body');
                    const emptyMessage = document.getElementById('users-table-empty');
                    
                    // Clear table
                    tableBody.innerHTML = '';
                    
                    // Show empty message if no users
                    if (this.filteredUsers.length === 0) {
                        emptyMessage.classList.remove('hidden');
                    } else {
                        emptyMessage.classList.add('hidden');
                        
                        // Render users
                        this.filteredUsers.forEach(user => {
                            const row = document.createElement('tr');
                            row.className = 'border-b dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50';
                            
                            // Determine role badge style
                            let roleBadge = '';
                            switch (user.role) {
                                case 'admin':
                                    roleBadge = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-500">Admin</span>`;
                                    break;
                                case 'manager':
                                    roleBadge = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-500">Manager</span>`;
                                    break;
                                case 'staff':
                                    roleBadge = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-500">Staff</span>`;
                                    break;
                            }
                            
                            // Determine status badge style
                            let statusBadge = '';
                            switch (user.status) {
                                case 'active':
                                    statusBadge = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-500">
                                        <svg class="-ml-0.5 mr-1.5 h-2 w-2 text-green-400" fill="currentColor" viewBox="0 0 8 8">
                                            <circle cx="4" cy="4" r="3" />
                                        </svg>
                                        Active
                                    </span>`;
                                    break;
                                case 'inactive':
                                    statusBadge = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-500">
                                        <svg class="-ml-0.5 mr-1.5 h-2 w-2 text-gray-400" fill="currentColor" viewBox="0 0 8 8">
                                            <circle cx="4" cy="4" r="3" />
                                        </svg>
                                        Inactive
                                    </span>`;
                                    break;
                            }
                            
                            // Format last login date
                            const formattedLogin = util.formatDate(user.lastLogin);
                            
                            row.innerHTML = `
                                <td class="px-4 py-3">
                                    <div class="flex items-center">
                                        <div class="w-8 h-8 rounded-full bg-primary-500 flex items-center justify-center text-white font-semibold mr-3">${user.name.charAt(0)}</div>
                                        <div>
                                            <p class="text-sm font-medium text-gray-900 dark:text-white">${user.name}</p>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">${user.email}</td>
                                <td class="px-4 py-3 text-sm">${roleBadge}</td>
                                <td class="px-4 py-3 text-sm">${statusBadge}</td>
                                <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">${formattedLogin}</td>
                                <td class="px-4 py-3 text-sm">
                                    <div class="flex items-center space-x-2">
                                        <button class="text-primary-600 dark:text-primary-400 hover:text-primary-800 dark:hover:text-primary-300" data-action="edit" data-id="${user.id}">
                                            <i class="ri-edit-line"></i>
                                        </button>
                                        <button class="text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300" data-action="delete" data-id="${user.id}" ${user.id === auth.currentUser.id ? 'disabled' : ''} ${user.id === auth.currentUser.id ? 'style="opacity: 0.5;"' : ''}>
                                            <i class="ri-delete-bin-line"></i>
                                        </button>
                                    </div>
                                </td>
                            `;
                            
                            // Add event listeners to action buttons
                            row.querySelectorAll('button[data-action]').forEach(btn => {
                                btn.addEventListener('click', (e) => {
                                    const action = btn.getAttribute('data-action');
                                    const userId = parseInt(btn.getAttribute('data-id'));
                                    
                                    if (action === 'edit') {
                                        this.showEditUserModal(userId);
                                    } else if (action === 'delete' && userId !== auth.currentUser.id) {
                                        this.showDeleteUserModal(userId);
                                    }
                                });
                            });
                            
                            tableBody.appendChild(row);
                        });
                    }
                },
                
                showAddUserModal() {
                    const modalContent = `
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Name</label>
                                <input id="user-name" type="text" class="w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Full name">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Email</label>
                                <input id="user-email" type="email" class="w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Email address">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Password</label>
                                <input id="user-password" type="password" class="w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Password">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Role</label>
                                <select id="user-role" class="w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <option value="admin">Admin</option>
                                    <option value="manager">Manager</option>
                                    <option value="staff" selected>Staff</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Status</label>
                                <select id="user-status" class="w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <option value="active" selected>Active</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                            </div>
                        </div>
                    `;
                    
                    const buttons = [
                        {
                            text: 'Cancel',
                            class: 'px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-300',
                            onClick: () => util.closeModal()
                        },
                        {
                            text: 'Add User',
                            class: 'px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors duration-300',
                            onClick: () => {
                                const name = document.getElementById('user-name').value;
                                const email = document.getElementById('user-email').value;
                                const password = document.getElementById('user-password').value;
                                const role = document.getElementById('user-role').value;
                                const status = document.getElementById('user-status').value;
                                
                                // Validation
                                if (!name || !email || !password) {
                                    util.showToast('Please fill in all required fields', 'error');
                                    return;
                                }
                                
                                // Check if email already exists
                                if (db.users.some(user => user.email === email)) {
                                    util.showToast('Email address already in use', 'error');
                                    return;
                                }
                                
                                // Add new user
                                const newUser = {
                                    id: Date.now(),
                                    name,
                                    email,
                                    password,
                                    role,
                                    status,
                                    lastLogin: 'Never'
                                };
                                
                                db.users.push(newUser);
                                
                                // Add activity log
                                db.activityLog.unshift({
                                    id: db.activityLog.length + 1,
                                    userId: auth.currentUser.id,
                                    userName: auth.currentUser.name,
                                    actionType: 'add_user',
                                    details: `Added new user: ${name}`,
                                    timestamp: new Date().toISOString().replace('T', ' ').split('.')[0]
                                });
                                
                                // Refresh user management
                                this.loadUsers();
                                
                                util.closeModal();
                                util.showToast('User added successfully', 'success');
                            }
                        }
                    ];
                    
                    util.showModal('Add User', modalContent, buttons);
                },
                
                showEditUserModal(userId) {
                    const user = this.users.find(u => u.id === userId);
                    if (!user) return;
                    
                    const modalContent = `
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Name</label>
                                <input id="user-name" type="text" class="w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Full name" value="${user.name}">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Email</label>
                                <input id="user-email" type="email" class="w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Email address" value="${user.email}">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Password</label>
                                <input id="user-password" type="password" class="w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Leave blank to keep current password">
                                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Leave blank to keep current password</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Role</label>
                                <select id="user-role" class="w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" ${user.id === auth.currentUser.id ? 'disabled' : ''}>
                                    <option value="admin" ${user.role === 'admin' ? 'selected' : ''}>Admin</option>
                                    <option value="manager" ${user.role === 'manager' ? 'selected' : ''}>Manager</option>
                                    <option value="staff" ${user.role === 'staff' ? 'selected' : ''}>Staff</option>
                                </select>
                                ${user.id === auth.currentUser.id ? '<p class="text-xs text-gray-500 dark:text-gray-400 mt-1">You cannot change your own role</p>' : ''}
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Status</label>
                                <select id="user-status" class="w-full px-3 py-2 text-base border rounded-md focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" ${user.id === auth.currentUser.id ? 'disabled' : ''}>
                                    <option value="active" ${user.status === 'active' ? 'selected' : ''}>Active</option>
                                    <option value="inactive" ${user.status === 'inactive' ? 'selected' : ''}>Inactive</option>
                                </select>
                                ${user.id === auth.currentUser.id ? '<p class="text-xs text-gray-500 dark:text-gray-400 mt-1">You cannot deactivate your own account</p>' : ''}
                            </div>
                        </div>
                    `;
                    
                    const buttons = [
                        {
                            text: 'Cancel',
                            class: 'px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-300',
                            onClick: () => util.closeModal()
                        },
                        {
                            text: 'Save Changes',
                            class: 'px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors duration-300',
                            onClick: () => {
                                const name = document.getElementById('user-name').value;
                                const email = document.getElementById('user-email').value;
                                const password = document.getElementById('user-password').value;
                                const role = user.id === auth.currentUser.id ? user.role : document.getElementById('user-role').value;
                                const status = user.id === auth.currentUser.id ? user.status : document.getElementById('user-status').value;
                                
                                // Validation
                                if (!name || !email) {
                                    util.showToast('Please fill in all required fields', 'error');
                                    return;
                                }
                                
                                // Check if email already exists (but not for this user)
                                if (db.users.some(u => u.email === email && u.id !== userId)) {
                                    util.showToast('Email address already in use', 'error');
                                    return;
                                }
                                
                                // Update user
                                const index = db.users.findIndex(u => u.id === userId);
                                if (index !== -1) {
                                    db.users[index] = {
                                        ...db.users[index],
                                        name,
                                        email,
                                        role,
                                        status
                                    };
                                    
                                    // Update password if provided
                                    if (password) {
                                        db.users[index].password = password;
                                    }
                                    
                                    // If updating current user, update auth.currentUser
                                    if (userId === auth.currentUser.id) {
                                        auth.currentUser = db.users[index];
                                        ui.updateUserInfo();
                                    }
                                    
                                    // Add activity log
                                    db.activityLog.unshift({
                                        id: db.activityLog.length + 1,
                                        userId: auth.currentUser.id,
                                        userName: auth.currentUser.name,
                                        actionType: 'update_user',
                                        details: `Updated user: ${name}`,
                                        timestamp: new Date().toISOString().replace('T', ' ').split('.')[0]
                                    });
                                    
                                    // Refresh user management
                                    this.loadUsers();
                                    
                                    util.closeModal();
                                    util.showToast('User updated successfully', 'success');
                                }
                            }
                        }
                    ];
                    
                    util.showModal('Edit User', modalContent, buttons);
                },
                
                showDeleteUserModal(userId) {
                    const user = this.users.find(u => u.id === userId);
                    if (!user) return;
                    
                    // Don't allow deleting current user
                    if (user.id === auth.currentUser.id) {
                        util.showToast('You cannot delete your own account', 'error');
                        return;
                    }
                    
                    const modalContent = `
                        <p class="text-gray-700 dark:text-gray-300 mb-4">Are you sure you want to delete user <span class="font-medium">${user.name}</span>?</p>
                        <p class="text-gray-700 dark:text-gray-300">This action cannot be undone.</p>
                    `;
                    
                    const buttons = [
                        {
                            text: 'Cancel',
                            class: 'px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-300',
                            onClick: () => util.closeModal()
                        },
                        {
                            text: 'Delete',
                            class: 'px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors duration-300',
                            onClick: () => {
                                // Remove user
                                const index = db.users.findIndex(u => u.id === userId);
                                if (index !== -1) {
                                    const deletedUser = db.users[index];
                                    db.users.splice(index, 1);
                                    
                                    // Add activity log
                                    db.activityLog.unshift({
                                        id: db.activityLog.length + 1,
                                        userId: auth.currentUser.id,
                                        userName: auth.currentUser.name,
                                        actionType: 'delete_user',
                                        details: `Deleted user: ${deletedUser.name}`,
                                        timestamp: new Date().toISOString().replace('T', ' ').split('.')[0]
                                    });
                                    
                                    // Refresh user management
                                    this.loadUsers();
                                    
                                    util.closeModal();
                                    util.showToast('User deleted successfully', 'success');
                                }
                            }
                        }
                    ];
                    
                    util.showModal('Delete User', modalContent, buttons);
                }
            };
            
            // Initialize app
            ui.init();
            stockManagement.init();
            orderManagement.init();
            reportsManagement.init();
            userManagement.init();
        });
    </script>
</body>
</html>

